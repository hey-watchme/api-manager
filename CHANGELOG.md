# API Manager 更新履歴

## [2.0.0] 2025年9月22日
### 🔄 Lambda移行による大規模アーキテクチャ変更
- **タイムブロック処理をLambdaに完全移行**
  - 第1段階（基礎分析）: azure-transcriber, behavior-features (AST), emotion-features (SUPERB)
  - 第2段階（集計）: behavior-aggregator, emotion-aggregator
  - 第3段階（気分分析）: timeblock-prompt, timeblock-analysis
- **累積分析処理のみスケジューラー継続**
  - dashboard-summary（毎時50分）
  - dashboard-summary-analysis（毎時00分）
- **処理モードの明確化**
  - タイムブロック処理: S3トリガーによるイベント駆動（48回/日）
  - 累積分析処理: Cronスケジューラー（24回/日）

## [1.9.0] 2025年9月20日
### 🎯 スケジューラーUIの完全削除
- **削除内容**: フロントエンドからスケジューラー関連のUI要素を完全に削除
  - 「自動処理」セクションの削除
  - 有効/無効トグル、実行時刻、エラー回数などの表示削除
- **バックエンド**: スケジューラー機能は引き続き正常動作（cronによる自動実行）
- **理由**: UIとバックエンドの設定の不整合を防ぎ、よりシンプルなアーキテクチャへ移行
- **影響**: スケジューラーの設定はREADMEを参照、実行はcronで管理

## 2025年9月11日
### 🚀 スケジューラー機能追加
- **dashboard-summary**: ダッシュボードサマリー生成（毎時50分実行）
- **dashboard-summary-analysis**: ダッシュボードサマリーChatGPT分析（毎時00分実行）

## 2025年9月9日  
### 🔧 Azure Transcriber処理改善
- バッチサイズを10件に制限
- 処理状態の細分化（pending → processing → completed/failed）
- ログ強化

## 2025年9月7日
### 🚀 timeblock-analysisスケジューラー追加
- dashboardテーブルのChatGPT分析自動化

## 2025年9月2日
### 🔧 ChatGPT分析機能修正
- **問題**: ChatGPT分析実行時に不適切にプロンプト生成APIを呼び出していた
- **解決**: Supabaseのdashboardテーブルから直接プロンプトを取得するように修正
- **影響**: 「プロンプトを取得できませんでした」エラーが解消
- **修正ファイル**: `src/pages/DashboardPage.jsx`

## 2025年9月1日
### 📊 ダッシュボード機能追加
- **新ナビゲーション**: 最左端に「ダッシュボード」タブを追加
- **タイムブロック処理**: 30分単位でのきめ細かいプロンプト生成
- **マルチモーダル統合**: Whisper + YAMNet + 観測対象者情報を統合
- **効率的UI**: 時間帯別クイック選択、複数タイムブロック一括処理
- **リアルタイム進捗**: 処理状況をプログレスバーで可視化
- **データ保存先**: 
  - プロンプト: dashboardテーブルの`prompt`カラム
  - ChatGPT分析結果: 同テーブルの`analysis_result`カラム
- **APIエンドポイント**: `GET /generate-timeblock-prompt`（api_gen_prompt_mood_chartコンテナ使用）
- **デバイス選択改善**: devicesテーブルからdevice_idのみを取得するシンプルな実装

## 2025年8月26日
### 🚀 Azure Speech Service API統合改善
- **新インターフェース**: デバイスID + 日付による効率的なバッチ処理
- **Supabase統合**: audio_filesテーブルからの自動ファイル取得
- **AWS S3統合**: 音声ファイルを直接取得して文字起こし実行
- **後方互換性**: 既存のfile_pathsインターフェースも継続サポート
- **タイムアウト延長**: 10分設定で長時間音声処理に対応
- **UI改善**: SDK 1.45.0の安定性アピール、処理状況の明確化
- **プロキシ対応**: 開発環境での/vibe-transcriber-v2エンドポイント対応

## 2025年8月25日
### 🎵 オーディオファイル機能実装
- **機能追加**: 音声ファイルの一覧表示・再生・ダウンロード機能
- **高度なフィルタリング**: local_dateベースの日付絞り込み + 3つの独立ステータスフィルター
- **開発者フレンドリーUI**: データベースカラム名をそのまま表示（device_id, local_date, time_block等）
- **VaultAPI連携**: 署名付きURL生成による安全な音声ファイルアクセス
- **レスポンシブ対応**: モバイル・デスクトップ両対応の完全なUI実装

## 2025年8月22日
### 🔧 環境変数の統一
- **環境変数の自動認識**: VITE_プレフィックス付き環境変数の自動認識を実装
- **全デバイス処理の修正**: スケジューラーが正しく全デバイスを処理するよう修正完了
- **動作確認済み**: 2025年8月21日のデータで3デバイスの処理を確認

## 2025年8月21日
### 🌐 全デバイス対応実装完了
- **全デバイス自動処理**: 手動処理・自動処理の両方で全デバイス自動処理に対応
- **UI大幅改善**: デバイスID入力フィールドを削除し、日付のみ指定する直感的なUIに変更
- **進捗表示機能**: 複数デバイス処理時のリアルタイム進捗バー・完了状況表示を実装
- **順次処理**: サーバー負荷を考慮した安全な順次処理方式を採用

## 2025年8月10日
### 🔄 スケジューラー完全実装
- **バックエンド実装**: 4つのデバイスベースAPIバックエンド実装完了
- **UUID標準化**: 正式なUUID v4形式に統一（`9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93`）
- **コンポーネント統合**: DeviceIdInputで重複コード削除、DRY原則実現
- **エンドポイント修正**: server_overview.md準拠で全API統一