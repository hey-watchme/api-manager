# API Manager - WatchMe ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

## æ¦‚è¦

API Managerã¯ã€WatchMeãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®è¤‡æ•°ã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹APIã‚’çµ±åˆç®¡ç†ã™ã‚‹ãŸã‚ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚å„APIã®æ‰‹å‹•å®Ÿè¡Œã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†ãªã©ã‚’ä¸€å…ƒçš„ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

**æœ¬ç•ªURL**: https://api.hey-watch.me/manager  
**é–‹ç™ºç’°å¢ƒ**: http://localhost:9001  
**GitHubãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/matsumotokaya/watchme-api-manager

### ğŸ“Š æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³

âœ… **ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†** - API Managerã¯æœ¬ç•ªç’°å¢ƒã§æ­£å¸¸ã«ç¨¼åƒä¸­ã§ã™

**æœ€çµ‚æ›´æ–°**: 2025å¹´9æœˆ3æ—¥  
**æ›´æ–°å±¥æ­´**: [CHANGELOG.md](./CHANGELOG.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„

#### ğŸ”— **ã‚³ãƒ³ãƒ†ãƒŠåã¨APIå¯¾å¿œè¡¨ï¼ˆ2025å¹´8æœˆ10æ—¥æ›´æ–° - å¿…ãšå‚ç…§ï¼‰**
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå„APIã¨é€šä¿¡ã™ã‚‹éš›ã®**æ­£ç¢ºãªã‚³ãƒ³ãƒ†ãƒŠå**ã¨ãƒãƒ¼ãƒˆç•ªå·ï¼š

| APIç¨®é¡ | UIä¸Šã®åå‰ | **å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒŠå** | ãƒãƒ¼ãƒˆ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | HTTPãƒ¡ã‚½ãƒƒãƒ‰ | å‡¦ç†ã‚¿ã‚¤ãƒ— |
|---------|-----------|---------------------|--------|----------------|-------------|-----------|
| ~~**[å¿ƒç†] Whisperæ›¸ãèµ·ã“ã—**~~ | ~~`whisper`~~ | ~~`api-transcriber`~~ | ~~8001~~ | ~~`/fetch-and-transcribe`~~ | ~~POST~~ | ~~ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹~~ | **â€»2025/09/02å‰Šé™¤æ¸ˆã¿** |
| **[å¿ƒç†] Azure Speechæ›¸ãèµ·ã“ã—** | `azure-transcriber` | `vibe-transcriber-v2` | 8013 | `/fetch-and-transcribe` | POST | ãƒ•ã‚¡ã‚¤ãƒ«&ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ |
| **[å¿ƒç†] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ** | `vibe-aggregator` | `api_gen_prompt_mood_chart` | 8009 | `/generate-mood-prompt-supabase` | **GET** âš ï¸ | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ |
| **[å¿ƒç†] ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°** | `vibe-scorer` | `api-gpt-v1` | 8002 | `/analyze-vibegraph-supabase` | POST | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ |
| **[è¡Œå‹•] éŸ³å£°ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡º** | `behavior-features` | `sed-api` | 8004 | `/fetch-and-process-paths` | POST | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ |
| **[è¡Œå‹•] éŸ³å£°ã‚¤ãƒ™ãƒ³ãƒˆé›†è¨ˆ** | `behavior-aggregator` | `api-sed-aggregator` | 8010 | `/analysis/sed` | POST | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ |
| **[æ„Ÿæƒ…] éŸ³å£°ç‰¹å¾´é‡æŠ½å‡º** | `emotion-features` | `opensmile-api` | 8011 | `/process/emotion-features` | POST | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ |
| **[æ„Ÿæƒ…] æ„Ÿæƒ…ã‚¹ã‚³ã‚¢é›†è¨ˆ** | `emotion-aggregator` | `opensmile-aggregator` | 8012 | `/analyze/opensmile-aggregator` | POST | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ |

**âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …:**
1. UIã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã¨å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒŠåã¯ç•°ãªã‚Šã¾ã™ï¼
2. `vibe-aggregator`ã®ã¿GETãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ï¼ˆä»–ã¯ã™ã¹ã¦POSTï¼‰
3. Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯`localhost`ã§ã¯ãªãã€å¿…ãšã‚³ãƒ³ãƒ†ãƒŠåã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
4. **Azure Speech API**: æ–°æ—§2ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’çµ±åˆã‚µãƒãƒ¼ãƒˆ
   - æ–°: `{"device_id": "uuid", "local_date": "2025-08-26", "model": "azure"}`
   - æ—§: `{"file_paths": ["path1", "path2"], "model": "azure"}`

#### è‡ªå‹•åŒ–æ¸ˆã¿API
ç¾åœ¨ã€ä»¥ä¸‹ã®APIã®è‡ªå‹•å®Ÿè¡ŒãŒAPI Managerã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ï¼š

##### âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…æ¸ˆã¿ï¼ˆå®Ÿéš›ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
- ~~**[å¿ƒç†] Whisperæ›¸ãèµ·ã“ã—**~~ - ~~ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†~~ â€»2025/09/02å‰Šé™¤ - Azure Speechã¸ç§»è¡Œ
- **[è¡Œå‹•] éŸ³å£°ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡º** - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†  
- **[æ„Ÿæƒ…] éŸ³å£°ç‰¹å¾´é‡æŠ½å‡º** - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†

##### âœ… ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹APIï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†ï¼‰
- **[å¿ƒç†] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ** - ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†
- **[å¿ƒç†] ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°** - ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†
- **[è¡Œå‹•] éŸ³å£°ã‚¤ãƒ™ãƒ³ãƒˆé›†è¨ˆ** - ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†
- **[æ„Ÿæƒ…] æ„Ÿæƒ…ã‚¹ã‚³ã‚¢é›†è¨ˆ** - ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹è‡ªå‹•å‡¦ç†

---

## ğŸ”§ Azure Transcriberå‡¦ç†æ”¹å–„ï¼ˆ2025å¹´9æœˆ9æ—¥å®Ÿè£…ï¼‰

### æ”¹å–„å†…å®¹

2025å¹´9æœˆ9æ—¥ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã€Azure Transcriberã®å‡¦ç†å®‰å®šæ€§ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã¾ã—ãŸã€‚

#### ä¸»ãªæ”¹å–„ç‚¹

1. **ãƒãƒƒãƒã‚µã‚¤ã‚ºã®æœ€é©åŒ–**
   - ä¸€åº¦ã«å‡¦ç†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’100ä»¶ã‹ã‚‰**10ä»¶ã«åˆ¶é™**
   - Azure Speech Serviceã¸ã®è² è·ã‚’è»½æ¸›ã—ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒªã‚¹ã‚¯ã‚’ä½æ¸›
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å‰Šæ¸›ã«ã‚ˆã‚Šã€å‡¦ç†ã®å®‰å®šæ€§ãŒå‘ä¸Š

2. **å‡¦ç†çŠ¶æ…‹ã®ç´°åˆ†åŒ–**
   - `pending` â†’ `processing` â†’ `completed/failed` ã®çŠ¶æ…‹é·ç§»ã‚’å®Ÿè£…
   - å‡¦ç†ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ˜ç¢ºã«è­˜åˆ¥å¯èƒ½ã«ãªã‚Šã€é‡è¤‡å‡¦ç†ã‚’é˜²æ­¢
   - ã‚¨ãƒ©ãƒ¼æ™‚ã¯ `failed` çŠ¶æ…‹ã«ç§»è¡Œã—ã€å•é¡Œã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®šå¯èƒ½

3. **ãƒ­ã‚°å¼·åŒ–**
   - å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†é–‹å§‹ãƒ»çµ‚äº†ã‚’å€‹åˆ¥ã«è¨˜éŒ²
   - å‡¦ç†æ™‚é–“ã®æ¸¬å®šã¨è¨˜éŒ²
   - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã®æ˜ç¤ºçš„ãªè¨˜éŒ²
   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è©³ç´°æƒ…å ±ã‚’å‡ºåŠ›

#### æŠ€è¡“è©³ç´°

```python
# scheduler/run-api-process-docker.py ã§ã®è¨­å®š
"azure-transcriber": {
    "endpoint": "http://vibe-transcriber-v2:8013/fetch-and-transcribe",
    "status_column": "transcriptions_status",
    "model": "azure",
    "display_name": "Azure Transcriber",
    "type": "file_based",
    "batch_size": 10,  # ä¸€åº¦ã«å‡¦ç†ã™ã‚‹æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’10ã«åˆ¶é™
    "timeout": 600  # 10åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
}
```

#### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

- **å‡¦ç†ã®é€æ˜æ€§å‘ä¸Š**: `processing` çŠ¶æ…‹ã«ã‚ˆã‚Šã€ç¾åœ¨å‡¦ç†ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ˜ç¢ºã«
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®æ”¹å–„**: å¤±æ•—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒ `failed` çŠ¶æ…‹ã¨ãªã‚Šã€åŸå› èª¿æŸ»ãŒå®¹æ˜“ã«
- **å®‰å®šæ€§ã®å‘ä¸Š**: ãƒãƒƒãƒã‚µã‚¤ã‚ºå‰Šæ¸›ã«ã‚ˆã‚Šã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒªã‚¹ã‚¯ãŒè»½æ¸›
- **ãƒ‡ãƒãƒƒã‚°ã®å®¹æ˜“åŒ–**: è©³ç´°ãªãƒ­ã‚°ã«ã‚ˆã‚Šã€å•é¡Œç™ºç”Ÿæ™‚ã®åŸå› ç‰¹å®šãŒè¿…é€Ÿã«

---

## ğŸš€ Azure Speech Service APIçµ±åˆæ©Ÿèƒ½ï¼ˆ2025å¹´8æœˆ26æ—¥å®Ÿè£…ï¼‰

### æ¦‚è¦

Azure Speech Service APIã®çµ±åˆæ©Ÿèƒ½ã¯ã€WatchMeãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã®å®Œå…¨çµ±åˆã«ã‚ˆã‚Šã€ãƒ‡ãƒã‚¤ã‚¹ID + æ—¥ä»˜ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒãƒƒãƒå‡¦ç†ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚å¾“æ¥ã®file_pathsã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«åŠ ãˆã€æ–°ã—ã„WatchMeã‚·ã‚¹ãƒ†ãƒ çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

**ã‚¢ã‚¯ã‚»ã‚¹URL**: https://api.hey-watch.me/manager/psychology/azure-transcriber

### ä¸»è¦æ©Ÿèƒ½

#### ğŸ”„ 2ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµ±åˆã‚µãƒãƒ¼ãƒˆ

**æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰**:
```json
{
  "device_id": "d067d407-cf73-4174-a9c1-d91fb60d64d0",
  "local_date": "2025-08-26",
  "time_blocks": ["09-00", "09-30", "10-00"],
  "model": "azure"
}
```

**æ—¢å­˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰**:
```json
{
  "file_paths": [
    "files/device_id/2025-08-25/23-00/audio.wav"
  ],
  "model": "azure"
}
```

#### âš¡ æŠ€è¡“çš„æ”¹å–„

- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·**: 10åˆ†è¨­å®šã§é•·æ™‚é–“ã®éŸ³å£°å‡¦ç†ã«å¯¾å¿œ
- **Supabaseçµ±åˆ**: `audio_files`ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å‡¦ç†å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å–å¾—
- **AWS S3çµ±åˆ**: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥å–å¾—ã—ã¦é«˜é€Ÿå‡¦ç†
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**: ã‚ˆã‚Šå®‰å®šã—ãŸAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†

#### ğŸ¨ UI/UXæ”¹å–„

- **å‰å‘ããªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: Azure Speech Service SDK 1.45.0ã®å®‰å®šæ€§ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«
- **å‡¦ç†æƒ…å ±ã®æ˜ç¢ºåŒ–**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ10åˆ†ã€è‡ªå‹•ä¿å­˜ã«ã¤ã„ã¦ã®æ¡ˆå†…
- **è­¦å‘Šã®å‰Šé™¤**: å•é¡Œè§£æ±ºã«ã‚ˆã‚Šä¸è¦ã«ãªã£ãŸè­¦å‘Šè¡¨ç¤ºã‚’æ’¤å»ƒ

### é–‹ç™ºç’°å¢ƒå¯¾å¿œ

#### ãƒ—ãƒ­ã‚­ã‚·è¨­å®š
```javascript
// vite.config.js - é–‹ç™ºç’°å¢ƒã§ã®ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ
'/vibe-transcriber-v2': {
  target: 'https://api.hey-watch.me',
  changeOrigin: true,
  secure: true
}
```

#### API Clientæ§‹é€ æ”¹å–„
```javascript
// AzureTranscriberApiClient.js - æ”¹å–„ã•ã‚ŒãŸæ§‹é€ 
constructor() {
  super({
    baseURL: 'https://api.hey-watch.me/vibe-transcriber-v2',
    timeout: 600000 // 10åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  })
}
```

---

## ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½ï¼ˆ2025å¹´9æœˆ1æ—¥å®Ÿè£…ãƒ»æ›´æ–°ï¼‰

### æ¦‚è¦

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½ã¯ã€30åˆ†å˜ä½ï¼ˆã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ï¼‰ã§ã®é«˜ç²¾åº¦ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚’å¯èƒ½ã«ã™ã‚‹æ–°æ©Ÿèƒ½ã§ã™ã€‚å¾“æ¥ã®1æ—¥å˜ä½ã®å‡¦ç†ã«åŠ ãˆã¦ã€ã‚ˆã‚Šç´°ã‹ã„æ™‚é–“å˜ä½ã§ã®å¿ƒç†çŠ¶æ…‹åˆ†æãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

**ã‚¢ã‚¯ã‚»ã‚¹URL**: https://api.hey-watch.me/manager/dashboard

### ä¸»è¦æ©Ÿèƒ½

#### ğŸ¯ ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
- **å‡¦ç†å˜ä½**: 30åˆ†ã”ã¨ã®ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ00-00, 00-30, 01-00...23-30ï¼‰
- **ãƒ‡ãƒ¼ã‚¿çµ±åˆ**: 
  - WhisperéŸ³å£°æ›¸ãèµ·ã“ã—ãƒ‡ãƒ¼ã‚¿ï¼ˆvibe_whisperãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
  - YAMNetéŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºãƒ‡ãƒ¼ã‚¿ï¼ˆbehavior_yamnetãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
  - è¦³æ¸¬å¯¾è±¡è€…æƒ…å ±ï¼ˆsubjectsãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ**: 
  - **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã®`prompt`ã‚«ãƒ©ãƒ 
  - **åˆ†æçµæœ**: ChatGPTåˆ†æå¾Œã€åŒãƒ†ãƒ¼ãƒ–ãƒ«ã®`analysis_result`ã‚«ãƒ©ãƒ ã«æ ¼ç´

#### ğŸ¨ ä½¿ã„ã‚„ã™ã„UIè¨­è¨ˆ
- **ãƒ‡ãƒã‚¤ã‚¹é¸æŠ**: 
  - Supabaseã®devicesãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è‡ªå‹•å–å¾—
  - ãƒ‡ãƒã‚¤ã‚¹IDã®ã¿ã‚’è¡¨ç¤ºï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªé¸æŠUIï¼‰
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒã‚¤ã‚¹IDã‚’è‡ªå‹•é¸æŠ
- **æ—¥ä»˜é¸æŠ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIã§ç°¡å˜æŒ‡å®š
- **ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯é¸æŠ**:
  - å€‹åˆ¥é¸æŠ: å¿…è¦ãªã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ã¿é¸æŠ
  - æ™‚é–“å¸¯åˆ¥ã‚¯ã‚¤ãƒƒã‚¯é¸æŠ: æ—©æœ/åˆå‰/åˆå¾Œ/å¤•æ–¹/å¤œãªã©
  - å…¨é¸æŠ/å…¨è§£é™¤: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§åˆ‡ã‚Šæ›¿ãˆ
- **é€²æ—è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨å‡¦ç†çŠ¶æ³è¡¨ç¤º

#### ğŸ”§ æŠ€è¡“ä»•æ§˜
- **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /generate-timeblock-prompt`
- **å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
  - `device_id`: ãƒ‡ãƒã‚¤ã‚¹IDï¼ˆUUIDå½¢å¼ï¼‰
  - `date`: å‡¦ç†æ—¥ä»˜ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
  - `time_block`: ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆHH-MMå½¢å¼ï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: api_gen_prompt_mood_chartã‚³ãƒ³ãƒ†ãƒŠï¼ˆãƒãƒ¼ãƒˆ8009ï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: æˆåŠŸ/å¤±æ•—çŠ¶æ…‹ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé•·ã€ãƒ‡ãƒ¼ã‚¿æœ‰ç„¡æƒ…å ±

#### ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 
- **devicesãƒ†ãƒ¼ãƒ–ãƒ«**: ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ï¼ˆdevice_idã®ã¿ã‚’ä½¿ç”¨ï¼‰
- **dashboardãƒ†ãƒ¼ãƒ–ãƒ«**:
  - `device_id`: ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥å­
  - `date`: å‡¦ç†æ—¥ä»˜
  - `time_block`: ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯
  - `prompt`: ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  - `analysis_result`: ChatGPTåˆ†æçµæœï¼ˆJSONå½¢å¼ï¼‰
  - `vibe_score`: æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ï¼ˆ-100ã€œ100ï¼‰
  - `summary`: åˆ†æçµæœã®ã‚µãƒãƒªãƒ¼

### é–‹ç™ºè€…å‘ã‘æƒ…å ±

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ DashboardPage.jsx              # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”œâ”€â”€ modules/dashboard/
â”‚   â”œâ”€â”€ DashboardTimeblockForm.jsx     # å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â””â”€â”€ DashboardTimeblockResults.jsx  # çµæœè¡¨ç¤º
â””â”€â”€ services/
    â””â”€â”€ DashboardApiClient.js          # APIé€šä¿¡
```

#### ä½¿ç”¨ä¾‹
```javascript
// APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½¿ç”¨ä¾‹
import dashboardApiClient from './services/DashboardApiClient'

const result = await dashboardApiClient.generateTimeblockPrompt(
  '9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93',  // device_id
  '2025-09-01',                              // date
  '19-30'                                     // time_block
)
```

---

## ğŸµ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«æ©Ÿèƒ½ï¼ˆ2025å¹´8æœˆ25æ—¥å®Ÿè£…ï¼‰

### æ¦‚è¦

ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«æ©Ÿèƒ½ã¯ã€WatchMeãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§éŒ²éŸ³ã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§è¡¨ç¤ºãƒ»å†ç”Ÿãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’å¯èƒ½ã«ã™ã‚‹æ–°æ©Ÿèƒ½ã§ã™ã€‚VaultAPIã¨é€£æºã—ã€ç½²åä»˜ãURLã«ã‚ˆã‚‹å®‰å…¨ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

**ã‚¢ã‚¯ã‚»ã‚¹URL**: https://api.hey-watch.me/manager/audio

### ä¸»è¦æ©Ÿèƒ½

#### ğŸ“‹ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº**: VaultAPIã‚’é€šã˜ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—
- **ã‚«ãƒ©ãƒ è¡¨ç¤º**: `device_id`, `file_size_bytes`, `local_date`, `time_block`, `status`
- **ãƒšãƒ¼ã‚¸ãƒ³ã‚°**: 50ä»¶ãšã¤ã®åŠ¹ç‡çš„ãªè¡¨ç¤º + ã€Œã‚‚ã£ã¨èª­ã¿è¾¼ã‚€ã€æ©Ÿèƒ½
- **ã‚½ãƒ¼ãƒˆ**: ä½œæˆæ—¥æ™‚é™é †ã§æœ€æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ªå…ˆè¡¨ç¤º

#### ğŸ” é«˜åº¦ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **ãƒ‡ãƒã‚¤ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: `device_id`ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠï¼‰
- **æ—¥ä»˜ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: `local_date_from` / `local_date_to`ã«ã‚ˆã‚‹éŒ²éŸ³æ—¥ãƒ™ãƒ¼ã‚¹ã®çµã‚Šè¾¼ã¿
- **3ã¤ã®ç‹¬ç«‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**:
  - `transcriptions_status` - è»¢å†™å‡¦ç†çŠ¶æ³
  - `behavior_features_status` - è¡Œå‹•åˆ†æå‡¦ç†çŠ¶æ³  
  - `emotion_features_status` - æ„Ÿæƒ…åˆ†æå‡¦ç†çŠ¶æ³
- **å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤**: `completed`, `processing`, `failed`, `pending`, `error`

#### ğŸµ éŸ³å£°å†ç”Ÿãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **ç½²åä»˜ãURL**: S3ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ1æ™‚é–“æœ‰åŠ¹ï¼‰
- **ãƒ–ãƒ©ã‚¦ã‚¶å†…å†ç”Ÿ**: HTML5 Audioã«ã‚ˆã‚‹ç›´æ¥å†ç”Ÿ
- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
- **ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º**: èª­ã¿è¾¼ã¿çŠ¶æ³ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º

#### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œ
- **ç½²åä»˜ãURL**: ä¸€æ™‚çš„ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã«ã‚ˆã‚‹å®‰å…¨ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹
- **CORSå¯¾å¿œ**: é–‹ç™ºç’°å¢ƒã§ã¯ãƒ—ãƒ­ã‚­ã‚·ã€æœ¬ç•ªç’°å¢ƒã§ã¯åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèªãƒ»ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯

### æŠ€è¡“ä»•æ§˜

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰
```javascript
// ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
src/modules/audio/
â”œâ”€â”€ AudioFilesModule.jsx      // ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ AudioFilesList.jsx        // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º
â”œâ”€â”€ AudioPlayer.jsx           // éŸ³å£°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
â”œâ”€â”€ AudioFilters.jsx          // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
â””â”€â”€ AudioFileRow.jsx          // å„è¡Œã®è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

// æ–°è¦ãƒšãƒ¼ã‚¸
src/pages/AudioFilesPage.jsx
```

#### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆVaultAPIé€£æºï¼‰
```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—
GET /api/audio-files?device_id=xxx&local_date_from=2025-08-25&transcriptions_status=completed

# ç½²åä»˜ãURLç”Ÿæˆ  
GET /api/audio-files/presigned-url?file_path=xxx&expiration_hours=1

# ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§å–å¾—
GET /api/devices
```

#### ç’°å¢ƒå¤‰æ•°
```bash
# VaultAPIé€£æºç”¨
VITE_VAULT_API_BASE_URL=https://api.hey-watch.me
```

### é–‹ç™ºè€…å‘ã‘æƒ…å ±

#### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
- **ãƒ—ãƒ­ã‚­ã‚·è¨­å®š**: `vite.config.js`ã§CORSå›é¿
- **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼**: http://localhost:9001/audio
- **Hot Module Replacement**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ¼ãƒ‰æ›´æ–°å¯¾å¿œ

#### æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# 1. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ãƒ»ECRãƒ—ãƒƒã‚·ãƒ¥
./deploy-frontend.sh

# 2. EC2ã§ã®ã‚³ãƒ³ãƒ†ãƒŠå±•é–‹
ssh -i ~/watchme-key.pem ubuntu@3.24.16.82
cd /home/ubuntu/watchme-api-manager
./deploy-frontend-ec2.sh
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **é…å»¶èª­ã¿è¾¼ã¿**: å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿
- **ãƒ¡ãƒ¢åŒ–**: React.memoã«ã‚ˆã‚‹ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢
- **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°APIå‘¼ã³å‡ºã—ã®æœ€é©åŒ–

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€UIã‚’æä¾›ã™ã‚‹ã€Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰(React)ã€ã¨ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æ©Ÿèƒ½ã‚’æ‹…ã†ã€Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API(Python)ã€ã®2ã¤ã®ã‚µãƒ¼ãƒãƒ¼ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ãƒªãƒã‚¸ãƒˆãƒªå†…ã®å„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**âš ï¸ é‡è¦**: ã‚·ã‚¹ãƒ†ãƒ ã«ã¯3ç¨®é¡ã®ç•°ãªã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã™ã€‚è©³ç´°ã¯ [ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®3å±¤æ§‹é€ ã‚’ç†è§£ã™ã‚‹](#-ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®3å±¤æ§‹é€ ã‚’ç†è§£ã™ã‚‹é‡è¦) ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¿…ãšå‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ğŸ• **ç¾åœ¨ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šä¸€è¦§ï¼ˆ2025å¹´9æœˆ7æ—¥æ›´æ–°ï¼‰**

#### **âš ï¸ é‡è¦ãªä»•æ§˜å¤‰æ›´**
- **Web UIã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼åˆ¶å¾¡ã¯å‰Šé™¤æ¸ˆã¿**ï¼ˆæ©Ÿèƒ½ã—ã¦ã„ãªã‹ã£ãŸãŸã‚ï¼‰
- **å®Ÿéš›ã®åˆ¶å¾¡**: cronè¨­å®šï¼ˆ`/etc/cron.d/watchme-scheduler`ï¼‰+ config.jsonï¼ˆæœ‰åŠ¹/ç„¡åŠ¹ã®ã¿ï¼‰ã§ç®¡ç†
- **è¨­å®šå¤‰æ›´**: æ‰‹å‹•ã§ã®cronãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ãŒå¿…è¦

#### **ğŸ“‹ å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§**

| å®Ÿè¡Œæ™‚åˆ» | APIå | æ©Ÿèƒ½ | é »åº¦ | æœ‰åŠ¹çŠ¶æ…‹ | å‡¦ç†ã‚¿ã‚¤ãƒ— | ã‚³ãƒ³ãƒ†ãƒŠå |
|---------|-------|------|------|----------|-----------|-----------|
| **æ¯æ™‚10åˆ†** | `azure-transcriber` | AzureéŸ³å£°æ›¸ãèµ·ã“ã— | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ | `vibe-transcriber-v2` |
| **æ¯æ™‚10åˆ†** | `behavior-features` | è¡Œå‹•ç‰¹å¾´æŠ½å‡º | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ | `sed-api` |
| **æ¯æ™‚20åˆ†** | `vibe-aggregator` | å¿ƒç†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆæ—¥æ¬¡ï¼‰ | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ | `api_gen_prompt_mood_chart` |
| **æ¯æ™‚20åˆ†** | `behavior-aggregator` | è¡Œå‹•ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ | `api-sed-aggregator` |
| **æ¯æ™‚20åˆ†** | `emotion-features` | æ„Ÿæƒ…ç‰¹å¾´æŠ½å‡º | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ | `opensmile-api` |
| **æ¯æ™‚30åˆ†** | `emotion-aggregator` | æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ | `opensmile-aggregator` |
| **æ¯æ™‚40åˆ†** | `timeblock-prompt` | ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ | `api_gen_prompt_mood_chart` |
| **æ¯æ™‚50åˆ†** | `timeblock-analysis` | ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ChatGPTåˆ†æ | æ¯æ™‚é–“ | âœ… æœ‰åŠ¹ | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ | `api-gpt-v1` |
| **30åˆ†ï¼ˆ3æ™‚é–“ã”ã¨ï¼‰** | `vibe-scorer` | å¿ƒç†ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚° | 8å›/æ—¥â€» | âœ… æœ‰åŠ¹ | ãƒ‡ãƒã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ | `api-gpt-v1` |
| ~~æ¯æ™‚10åˆ†~~ | ~~`whisper`~~ | ~~Whisperæ›¸ãèµ·ã“ã—~~ | ~~åœæ­¢~~ | âŒ ç„¡åŠ¹ | ~~å‰Šé™¤æ¸ˆã¿~~ | ~~å‰Šé™¤æ¸ˆã¿~~ |

**â€» vibe-scorerå®Ÿè¡Œæ™‚åˆ»**: 0:30, 3:30, 6:30, 9:30, 12:30, 15:30, 18:30, 21:30ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ï¼‰

#### **ğŸ“Š å®Ÿè¡Œé »åº¦ã®è©³ç´°**

**æ¯æ™‚é–“å®Ÿè¡Œï¼ˆ24å›/æ—¥ï¼‰**:
- AzureéŸ³å£°æ›¸ãèµ·ã“ã—ï¼ˆæ¯æ™‚10åˆ†ï¼‰
- è¡Œå‹•ç‰¹å¾´æŠ½å‡ºï¼ˆæ¯æ™‚10åˆ†ï¼‰
- å¿ƒç†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ»æ—¥æ¬¡é›†è¨ˆï¼ˆæ¯æ™‚20åˆ†ï¼‰
- è¡Œå‹•ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆæ¯æ™‚20åˆ†ï¼‰
- æ„Ÿæƒ…ç‰¹å¾´æŠ½å‡ºï¼ˆæ¯æ™‚20åˆ†ï¼‰
- æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆæ¯æ™‚30åˆ†ï¼‰
- **ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆæ¯æ™‚40åˆ†ï¼‰** ğŸ†•
- **ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ChatGPTåˆ†æï¼ˆæ¯æ™‚50åˆ†ï¼‰** ğŸ†• ï¼ˆ2025/09/07è¿½åŠ ï¼‰

**3æ™‚é–“ã”ã¨å®Ÿè¡Œï¼ˆ8å›/æ—¥ï¼‰**:
- å¿ƒç†ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚é »åº¦ã‚’åˆ¶é™ï¼‰

#### **ğŸ†• timeblock-prompt ã®ç‰¹å¾´**
- **å‡¦ç†å†…å®¹**: 3ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆvibe_whisper, behavior_yamnet, emotion_opensmileï¼‰ã‹ã‚‰`pending`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã—ã¦å‡¦ç†
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/generate-timeblock-prompt`ï¼ˆvibe-aggregatorã¨ã¯ç•°ãªã‚‹ï¼‰
- **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ä»–ã®APIã®å‡¦ç†å®Œäº†å¾Œï¼ˆ40åˆ†ï¼‰ã«å®Ÿè¡Œ
- **ãƒãƒƒãƒå‡¦ç†**: 1å›ã®å®Ÿè¡Œã§æœ€å¤§10ä»¶ã®ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‡¦ç†ï¼ˆconfig.jsonã§èª¿æ•´å¯èƒ½ï¼‰

#### **ğŸ†• timeblock-analysis ã®ç‰¹å¾´** ï¼ˆ2025/09/07è¿½åŠ ï¼‰
- **å‡¦ç†å†…å®¹**: dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã®`status='pending'`ã‹ã¤`prompt IS NOT NULL`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ChatGPTã§åˆ†æ
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /analyze-timeblock`ï¼ˆapi-gpt-v1ã‚³ãƒ³ãƒ†ãƒŠï¼‰
- **å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: timeblock-promptã®10åˆ†å¾Œï¼ˆ50åˆ†ï¼‰ã«å®Ÿè¡Œ
- **ãƒãƒƒãƒå‡¦ç†**: 1å›ã®å®Ÿè¡Œã§æœ€å¤§50ä»¶ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‡¦ç†ï¼ˆconfig.jsonã§èª¿æ•´å¯èƒ½ï¼‰
- **çµæœä¿å­˜**: analysis_resultã€vibe_scoreã€summaryã‚’dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã—ã€statusã‚’'completed'ã«æ›´æ–°

#### **ğŸ”§ è¨­å®šå¤‰æ›´æ–¹æ³•**

1. **æœ‰åŠ¹/ç„¡åŠ¹ã®åˆ‡ã‚Šæ›¿ãˆ**:
   ```bash
   # config.jsonã‚’ç›´æ¥ç·¨é›†
   sudo nano /home/ubuntu/scheduler/config.json
   ```

2. **å®Ÿè¡Œæ™‚åˆ»ã®å¤‰æ›´**:
   ```bash  
   # cronãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
   sudo nano /etc/cron.d/watchme-scheduler
   ```

3. **æ–°ã—ã„APIã®è¿½åŠ **:
   - cronãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ 
   - config.jsonã«è¨­å®šã‚’è¿½åŠ 
   - run_if_enabled.pyãŒè‡ªå‹•ã§APIå®Ÿè¡Œã‚’åˆ¶å¾¡

#### ä»•çµ„ã¿ã®è©³ç´°

1. **UIã‹ã‚‰ã®åˆ¶å¾¡**
   - API Managerã®ç”»é¢ã§å„APIã®ON/OFFã‚’åˆ‡ã‚Šæ›¿ãˆ
   - è¨­å®šã¯ `/home/ubuntu/scheduler/config.json` ã«ä¿å­˜
   - å®Ÿè¡Œé–“éš”ã®å¤‰æ›´ã¯ã§ãã¾ã›ã‚“ï¼ˆå›ºå®šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰

2. **cronè¨­å®š** (`/etc/cron.d/watchme-scheduler`)
   - ãƒ›ã‚¹ãƒˆOSå´ã§å›ºå®šæ™‚åˆ»ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
   - è² è·åˆ†æ•£ã®ãŸã‚ã€APIã”ã¨ã«å®Ÿè¡Œæ™‚åˆ»ã‚’ãšã‚‰ã—ã¦ã„ã‚‹

3. **å®Ÿè¡Œåˆ¶å¾¡** (`run_if_enabled.py`)
   - cronã‹ã‚‰å‘¼ã°ã‚Œã‚‹Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - config.jsonã‚’èª­ã¿ã€APIãŒæœ‰åŠ¹ãªå ´åˆã®ã¿å®Ÿè¡Œ
   - `docker exec` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠå†…ã®APIã‚’èµ·å‹•

4. **ãƒ­ã‚°ç®¡ç†**
   - å„APIã®å®Ÿè¡Œãƒ­ã‚°: `/var/log/scheduler/scheduler-[APIå].log`
   - cronå®Ÿè¡Œãƒ­ã‚°: `/var/log/scheduler/cron.log`

#### ãªãœã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãªã®ã‹ï¼Ÿ

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Dockerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ›ã‚¹ãƒˆã®ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãªã„
- **ã‚·ãƒ³ãƒ—ãƒ«**: cronè¨­å®šã¯é™çš„ã§ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå®¹æ˜“
- **æŸ”è»Ÿæ€§**: UIã‹ã‚‰ON/OFFåˆ¶å¾¡å¯èƒ½ã€å®Ÿè¡Œæ™‚åˆ»ã¯é‹ç”¨ã§æœ€é©åŒ–æ¸ˆã¿
- **è² è·åˆ†æ•£**: APIã‚’æ™‚é–“å·®ã§å®Ÿè¡Œã—ã€ã‚µãƒ¼ãƒãƒ¼è² è·ã‚’å¹³æº–åŒ–

---

## ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹IDè¨­å®šç®¡ç†ï¼ˆé‡è¦ï¼‰

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒã‚¤ã‚¹IDã®ä¸€å…ƒç®¡ç†

**å•é¡Œ**: ãƒ‡ãƒã‚¤ã‚¹IDãŒè¤‡æ•°ç®‡æ‰€ã«åˆ†æ•£ã—ã¦ã„ã‚‹ã¨ã€å¤‰æ›´æ™‚ã«ä¿®æ­£æ¼ã‚ŒãŒç™ºç”Ÿã™ã‚‹

**è§£æ±ºç­–**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¨­å®šã‚’å”¯ä¸€ã®çœŸå®Ÿã®æºï¼ˆSingle Source of Truthï¼‰ã¨ã™ã‚‹

#### ãƒ‡ãƒã‚¤ã‚¹IDå¤‰æ›´æ‰‹é †

1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å¤‰æ›´**
   - `src/config/constants.js` ã® `DEFAULT_DEVICE_ID` ã‚’å¤‰æ›´
   - ã“ã‚Œã«ã‚ˆã‚Šå…¨ã¦ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åæ˜ ã•ã‚Œã‚‹

2. **æœ¬ç•ªç’°å¢ƒã¸ã®åæ˜ **
   - API Managerã®ç”»é¢ã‹ã‚‰å„APIã®è¨­å®šã‚’ä¿å­˜
   - ã“ã‚Œã«ã‚ˆã‚Š `/home/ubuntu/scheduler/config.json` ãŒæ›´æ–°ã•ã‚Œã‚‹
   - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã«æ–°ã—ã„ãƒ‡ãƒã‚¤ã‚¹IDã‚’ä½¿ç”¨

3. **ç¢ºèªæ–¹æ³•**
   ```bash
   # æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œ
   cat /home/ubuntu/scheduler/config.json | jq '.apis[].deviceId'
   ```

#### âš ï¸ æ³¨æ„äº‹é …

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯é¿ã‘ã‚‹**
- config.jsonãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã¯è­¦å‘Šã‚’å‡ºåŠ›
- ç·Šæ€¥æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã¯ `scheduler/run-api-process-docker.py` ã«è¨˜è¼‰

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å„ªå…ˆé †ä½

1. `/home/ubuntu/scheduler/config.json` ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰è¨­å®šï¼‰
2. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ï¼ˆè­¦å‘Šä»˜ãã§ä½¿ç”¨ï¼‰

---

## ğŸ¨ UIä»•æ§˜ãƒ»æ“ä½œæ–¹æ³•ï¼ˆ2025å¹´8æœˆ21æ—¥æ›´æ–°ï¼‰

### ğŸ“± å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œUI

2025å¹´8æœˆ21æ—¥ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã€**ãƒ‡ãƒã‚¤ã‚¹IDå…¥åŠ›ã‚’å®Œå…¨ã«å»ƒæ­¢**ã—ã€**å…¨ãƒ‡ãƒã‚¤ã‚¹è‡ªå‹•å‡¦ç†**ã«å¯¾å¿œã—ã¾ã—ãŸã€‚

#### ğŸ”§ æ‰‹å‹•å‡¦ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³

**æ–°ã—ã„ä»•æ§˜**:
- âœ… **æ—¥ä»˜ã®ã¿é¸æŠ**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å‡¦ç†å¯¾è±¡æ—¥ã‚’é¸æŠ
- âœ… **å…¨ãƒ‡ãƒã‚¤ã‚¹è‡ªå‹•å‡¦ç†**: æŒ‡å®šæ—¥ä»˜ã®å…¨ãƒ‡ãƒã‚¤ã‚¹IDã‚’è‡ªå‹•æ¤œå‡ºãƒ»é †æ¬¡å‡¦ç†
- âœ… **é€²æ—è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—ãƒãƒ¼ãƒ»ãƒ‡ãƒã‚¤ã‚¹åˆ¥å®Œäº†çŠ¶æ³ã‚’è¡¨ç¤º

**æ“ä½œæ‰‹é †**:
1. æ—¥ä»˜ã‚’é¸æŠï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šæœ¬æ—¥ï¼‰
2. ã€ŒğŸ¤– [APIå]é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. é€²æ—ãƒãƒ¼ã§å‡¦ç†çŠ¶æ³ã‚’ç¢ºèª
4. å®Œäº†å¾Œã«çµæœã‚’ç¢ºèª

**UIä¾‹**:
```
ğŸ”§ æ‰‹å‹•å‡¦ç†

å‡¦ç†å¯¾è±¡æ—¥ä»˜: [2025/8/21 â–¼]
ğŸ“Š å‡¦ç†å†…å®¹ï¼šæŒ‡å®šã—ãŸæ—¥ä»˜ã®å…¨ãƒ‡ãƒã‚¤ã‚¹ãŒå‡¦ç†å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚

[ğŸ¤– è¡Œå‹•åˆ†æé–‹å§‹]

--- å‡¦ç†ä¸­ã®è¡¨ç¤º ---
å‡¦ç†é€²æ—: 2/3 (67%)
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 

âœ… 9f7d6e27...  
ğŸ”„ 3a8b9c15...  â† å‡¦ç†ä¸­
âšª 7e2f4d8a...  

å®Œäº†: 2/3 ãƒ‡ãƒã‚¤ã‚¹ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ
```

#### ğŸ¤– è‡ªå‹•å‡¦ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ï¼‰

**æ–°ã—ã„ä»•æ§˜**:
- âœ… **ãƒ‡ãƒã‚¤ã‚¹IDå…¥åŠ›å»ƒæ­¢**: ã€ŒğŸ“± å…¨ãƒ‡ãƒã‚¤ã‚¹ã€ã¨å›ºå®šè¡¨ç¤º
- âœ… **æ—¥ä»˜è‡ªå‹•æ›´æ–°**: æ¯æ—¥è‡ªå‹•ã§å½“æ—¥ã«è¨­å®š
- âœ… **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤º**: å®Ÿè¡Œæ™‚åˆ»ãƒ»é »åº¦ã‚’æ˜ç¢ºã«è¡¨ç¤º

**UIä¾‹**:
```
ğŸ¤– Behavior Aggregator è‡ªå‹•å‡¦ç†
âœ… æœ‰åŠ¹

ğŸ“… å®Ÿè¡Œæ™‚åˆ»: æ¯æ™‚20åˆ† (æ¯æ™‚é–“)

å‡¦ç†å¯¾è±¡: ğŸ“± å…¨ãƒ‡ãƒã‚¤ã‚¹
å‡¦ç†æ—¥ä»˜: 2025/8/21ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰

[ğŸŸ¢ æœ‰åŠ¹]

ğŸ“Š æœ€çµ‚å‡¦ç†: 2025/8/21 7:22:15
```

#### ğŸ¯ å¯¾è±¡APIï¼ˆå…¨4ã¤ï¼‰

ä»¥ä¸‹ã®4ã¤ã®APIãŒå…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œæ¸ˆã¿ã§ã™ï¼š

1. **ğŸ¤– Behavior Aggregator**ï¼ˆè¡Œå‹•ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼‰
   - å®Ÿè¡Œæ™‚åˆ»: æ¯æ™‚20åˆ†
   - YamNetãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹éŸ³éŸ¿ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ

2. **ğŸ“Š Emotion Aggregator**ï¼ˆæ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼‰
   - å®Ÿè¡Œæ™‚åˆ»: æ¯æ™‚30åˆ†
   - OpenSMILEéŸ³å£°ç‰¹å¾´é‡ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ

3. **ğŸ“ Vibe Aggregator**ï¼ˆå¿ƒç†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼‰
   - å®Ÿè¡Œæ™‚åˆ»: æ¯æ™‚20åˆ†
   - 48ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ30åˆ†å˜ä½ï¼‰ã®Transcriberãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦å‡¦ç†

4. **ğŸ¤– Vibe Scorer**ï¼ˆå¿ƒç†ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼‰
   - å®Ÿè¡Œæ™‚åˆ»: 30åˆ†ï¼ˆ3æ™‚é–“ã”ã¨ï¼‰â€»ç‰¹åˆ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
   - ChatGPTã§å¿ƒç†ã‚¹ã‚³ã‚¢ã‚’åˆ†æ

5. **ğŸµ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†**ï¼ˆ2025å¹´8æœˆ25æ—¥è¿½åŠ ï¼‰
   - ã‚¢ã‚¯ã‚»ã‚¹: https://api.hey-watch.me/manager/audio
   - éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§è¡¨ç¤ºãƒ»å†ç”Ÿãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - VaultAPIé€£æºã«ã‚ˆã‚‹ç½²åä»˜ãURLã‚¢ã‚¯ã‚»ã‚¹

#### âš¡ æŠ€è¡“ä»•æ§˜

**å‡¦ç†æ–¹å¼**:
- **é †æ¬¡å‡¦ç†**: ã‚µãƒ¼ãƒãƒ¼è² è·ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã€ãƒ‡ãƒã‚¤ã‚¹ã‚’1ã¤ãšã¤é †ç•ªã«å‡¦ç†
- **é€²æ—è¿½è·¡**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å‡¦ç†çŠ¶æ³ã‚’è¡¨ç¤º
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ‡ãƒã‚¤ã‚¹å˜ä½ã§ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒãƒ»ãƒ­ã‚°å‡ºåŠ›
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§å–å¾—å¤±æ•—æ™‚ã¯ãƒ†ã‚¹ãƒˆãƒ‡ãƒã‚¤ã‚¹IDã‚’ä½¿ç”¨

**å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `AllDevicesDateForm.jsx`: æ—¥ä»˜ã®ã¿é¸æŠãƒ•ã‚©ãƒ¼ãƒ 
- `DeviceProcessingProgress.jsx`: é€²æ—è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `AutoProcessControlWithParams.jsx`: å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œè‡ªå‹•å‡¦ç†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«

**ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«å°‚ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `AudioFilesModule.jsx`: ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- `AudioFilters.jsx`: local_dateãƒ™ãƒ¼ã‚¹ + 3ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- `AudioFilesList.jsx`: ãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º  
- `AudioPlayer.jsx`: ç½²åä»˜ãURL + HTML5Audioå†ç”Ÿ
- `AudioFileRow.jsx`: device_id/local_date/time_blockè¡¨ç¤º

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ğŸš¨ ãƒ–ãƒ©ãƒ³ãƒé‹ç”¨ãƒ«ãƒ¼ãƒ«ï¼ˆå¿…é ˆï¼‰

**é‡è¦**: featureãƒ–ãƒ©ãƒ³ãƒã§ä½œæ¥­ã—ãŸå†…å®¹ã¯ã€å¿…ãšmainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚

1. **featureãƒ–ãƒ©ãƒ³ãƒã§ã®é–‹ç™º**
   ```bash
   # æ–°æ©Ÿèƒ½ã®é–‹ç™ºã‚’é–‹å§‹
   git checkout -b feature/æ–°æ©Ÿèƒ½å
   
   # é–‹ç™ºãƒ»ã‚³ãƒŸãƒƒãƒˆ
   git add .
   git commit -m "feat: æ–°æ©Ÿèƒ½ã®èª¬æ˜"
   ```

2. **mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸ï¼ˆå¿…é ˆï¼‰**
   ```bash
   # mainãƒ–ãƒ©ãƒ³ãƒã‚’æœ€æ–°ã«æ›´æ–°
   git checkout main
   git pull origin main
   
   # featureãƒ–ãƒ©ãƒ³ãƒã‚’ãƒãƒ¼ã‚¸
   git merge feature/æ–°æ©Ÿèƒ½å
   
   # ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥
   git push origin main
   ```

3. **Pull Requestã®æ´»ç”¨ï¼ˆæ¨å¥¨ï¼‰**
   - å¤§ããªå¤‰æ›´ã®å ´åˆã¯ã€GitHubã§Pull Requestã‚’ä½œæˆ
   - ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµŒã¦ãƒãƒ¼ã‚¸

**âš ï¸ æ³¨æ„**: 
- featureãƒ–ãƒ©ãƒ³ãƒã§ä½œæ¥­ã—ãŸã¾ã¾æ”¾ç½®ã—ãªã„
- mainãƒ–ãƒ©ãƒ³ãƒãŒå”¯ä¸€ã®çœŸå®Ÿã®æºï¼ˆSingle Source of Truthï¼‰
- ãƒ‡ãƒ—ãƒ­ã‚¤ã¯å¿…ãšmainãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰å®Ÿè¡Œ

#### ğŸ§¹ ãƒ–ãƒ©ãƒ³ãƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆå®šæœŸå®Ÿè¡Œæ¨å¥¨ï¼‰

**å•é¡Œ**: å¤ã„featureãƒ–ãƒ©ãƒ³ãƒãŒæ®‹ã‚‹ã¨ã€ã©ã‚ŒãŒæœ€æ–°ã‹åˆ†ã‹ã‚‰ãªããªã‚‹

**è§£æ±ºç­–**: ãƒãƒ¼ã‚¸å¾Œã¯å¿…ãšä¸è¦ãªãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ã™ã‚‹
```bash
# 1. ãƒãƒ¼ã‚¸æ¸ˆã¿ãƒ–ãƒ©ãƒ³ãƒã®ç¢ºèª
git branch --merged main

# 2. ä¸è¦ãªãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤
git branch -d feature/å¤ã„ãƒ–ãƒ©ãƒ³ãƒå

# 3. å­¤ç«‹ã—ãŸãƒ–ãƒ©ãƒ³ãƒï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã«ãªã„ï¼‰ã‚’ç¢ºèª
git branch -vv | grep "\[gone\]"

# 4. å­¤ç«‹ãƒ–ãƒ©ãƒ³ãƒã‚’å¼·åˆ¶å‰Šé™¤ï¼ˆå†…å®¹ç¢ºèªå¾Œï¼‰
git branch -D feature/å­¤ç«‹ã—ãŸãƒ–ãƒ©ãƒ³ãƒå

# 5. ãƒªãƒ¢ãƒ¼ãƒˆã®å‰Šé™¤æ¸ˆã¿ãƒ–ãƒ©ãƒ³ãƒã‚’åæ˜ 
git remote prune origin
```

**å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**:
- æœˆ1å›ç¨‹åº¦ã€`git branch -vv` ã§ãƒ–ãƒ©ãƒ³ãƒçŠ¶æ³ã‚’ç¢ºèª
- `[gone]` è¡¨ç¤ºã®ã‚ã‚‹ãƒ–ãƒ©ãƒ³ãƒã¯å‰Šé™¤å¯¾è±¡

---

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶
- Node.js 18ä»¥ä¸Š
- Python 3.11ä»¥ä¸Šï¼ˆæœ¬ç•ªç’°å¢ƒã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼å®Ÿè¡Œç”¨ï¼‰
- Docker, Docker Compose

### ç’°å¢ƒå¤‰æ•°è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# Supabaseè¨­å®š
# VITE_ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReact/Viteï¼‰ç”¨
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPythonï¼‰ã¯è‡ªå‹•çš„ã«VITE_ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã‚‚èªè­˜ã—ã¾ã™
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_KEY=your_supabase_key

# API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
VITE_API_BASE_URL=https://api.hey-watch.me

# é–‹ç™ºç’°å¢ƒè¨­å®š
VITE_PORT=9001
```

**é‡è¦**: 
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰ã¯`VITE_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã®ç’°å¢ƒå¤‰æ•°ã®ã¿ä½¿ç”¨
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPython/ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ï¼‰ã¯`VITE_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã‚‚è‡ªå‹•èªè­˜ï¼ˆ2025å¹´8æœˆ22æ—¥æ›´æ–°ï¼‰
- ç’°å¢ƒå¤‰æ•°ã®é‡è¤‡è¨˜è¿°ã¯ä¸è¦

### èµ·å‹•æ‰‹é †

1.  **ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³**
    ```bash
    git clone git@github.com:matsumotokaya/watchme-api-manager.git
    cd watchme-api-manager
    ```

2.  **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•**
    ```bash
    # æ¨å¥¨ï¼šå°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•
    ./start-frontend-dev.sh
    
    # ã¾ãŸã¯æ‰‹å‹•èµ·å‹•
    npm install
    npm run dev
    
    # => http://localhost:9001 ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    ```

### âš ï¸ é‡è¦ï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æ©Ÿèƒ½ã«ã¤ã„ã¦

**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æ©Ÿèƒ½ã¯æœ¬ç•ªç’°å¢ƒï¼ˆEC2ã‚µãƒ¼ãƒãƒ¼ï¼‰ã§ã®ã¿å‹•ä½œã—ã¾ã™ã€‚**

ç†ç”±ï¼š
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã¯ãƒ›ã‚¹ãƒˆOSã®cronã‚¸ãƒ§ãƒ–ã¨é€£æºã—ã¦å‹•ä½œ
- å„APIã‚³ãƒ³ãƒ†ãƒŠã¸ã®æ¥ç¶šã¯Dockerå†…ã®watchme-networkçµŒç”±ã§è¡Œã‚ã‚Œã‚‹
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯ã€UIã®å‹•ä½œç¢ºèªã¯å¯èƒ½ã ãŒã€å®Ÿéš›ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã¯ã§ããªã„

æœ¬ç•ªç’°å¢ƒã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆæ–¹æ³•ã«ã¤ã„ã¦ã¯ã€ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ğŸš¨ é‡è¦ï¼šAPI Managerã¨Schedulerã®é–¢ä¿‚ã‚’ç†è§£ã™ã‚‹ï¼ˆå¿…èª­ï¼‰

**API Managerã‚µãƒ¼ãƒ“ã‚¹ã¯2ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š**

| ã‚³ãƒ³ãƒ†ãƒŠå | å½¹å‰² | ãƒãƒ¼ãƒˆ | ç®¡ç†ãƒ•ã‚¡ã‚¤ãƒ« |
|-----------|------|--------|------------|
| **watchme-api-manager-prod** | WebUIï¼ˆReactï¼‰ | 9001 | docker-compose.prod.yml |
| **watchme-scheduler-prod** | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼APIï¼ˆPythonï¼‰ | 8015 | docker-compose.all.ymlï¼ˆä¸¡æ–¹å«ã‚€ï¼‰ |

### âš ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æœ€é‡è¦æ³¨æ„äº‹é …

**çµ¶å¯¾ã«é–“é•ãˆã¦ã¯ã„ã‘ãªã„ã“ã¨ï¼š**

1. **systemdè¨­å®šã¯å¿…ãš`docker-compose.all.yml`ã‚’ä½¿ç”¨**
   - âŒ é–“é•ã„ï¼š`docker-compose.prod.yml`ï¼ˆAPI Managerã®ã¿èµ·å‹•ï¼‰
   - âœ… æ­£è§£ï¼š`docker-compose.all.yml`ï¼ˆAPI Manager + Schedulerä¸¡æ–¹èµ·å‹•ï¼‰

2. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã¯å¿…ãš`external: true`**
   ```yaml
   # docker-compose.all.ymlã®æœ€å¾Œ
   networks:
     watchme-network:
       external: true  # âœ… æ—¢å­˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨
       # driver: bridge âŒ æ–°è¦ä½œæˆã—ã¦ã—ã¾ã†ã®ã§çµ¶å¯¾NG
   ```

3. **ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã¯ä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’å¿…ãšç¢ºèª**
   ```bash
   docker ps | grep -E "api-manager|scheduler"
   # ä¸¡æ–¹è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   ```

### ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ã€ECR (Elastic Container Registry) ã‚’åˆ©ç”¨ã—ã¦è¡Œã„ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼APIã¯ã€ãã‚Œãã‚Œåˆ¥ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã•ã‚Œã€EC2ä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

#### âš ï¸ å‰ææ¡ä»¶ï¼šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ•ãƒ©ã®ç¢ºèªï¼ˆ2025å¹´8æœˆ28æ—¥è¿½åŠ ï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã€`watchme-network`ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```bash
# EC2ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œ
ssh -i ~/watchme-key.pem ubuntu@3.24.16.82

# watchme-networkã®å­˜åœ¨ç¢ºèªã¨çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
bash /home/ubuntu/watchme-server-configs/scripts/check-infrastructure.sh

# å•é¡ŒãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•ä¿®å¾©
python3 /home/ubuntu/watchme-server-configs/scripts/network_monitor.py --fix
```

#### ğŸš€ æ¨å¥¨ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆå®‰å…¨ãªæ–¹æ³•ï¼‰

**é‡è¦ï¼šå¿…ãšä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€ç·’ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„**

```bash
# 1. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ECRã¸ãƒ—ãƒƒã‚·ãƒ¥
./deploy-frontend.sh        # API Manager (UI)ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥
./deploy-scheduler.sh       # Scheduler APIã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥

# 2. EC2ã‚µãƒ¼ãƒãƒ¼ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å±•é–‹
ssh -i ~/watchme-key.pem ubuntu@3.24.16.82
cd /home/ubuntu/watchme-api-manager

# 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆé‡è¦ï¼ï¼‰
# docker-compose.all.ymlã®æœ€å¾ŒãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
tail -5 docker-compose.all.yml
# networks:
#   watchme-network:
#     external: true  â† ã“ã‚ŒãŒé‡è¦ï¼

# 4. ä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€ç·’ã«å†èµ·å‹•ï¼ˆæ¨å¥¨æ–¹æ³•ï¼‰
docker-compose -f docker-compose.all.yml pull
docker-compose -f docker-compose.all.yml down
docker-compose -f docker-compose.all.yml up -d

# 5. å¿…ãšä¸¡æ–¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
docker ps | grep -E "api-manager|scheduler"
# ä»¥ä¸‹ã®2è¡ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
# watchme-api-manager-prod ... Up ... 9001
# watchme-scheduler-prod   ... Up ... 8015

# 6. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:9001/  # UIå¿œç­”ç¢ºèª
curl http://localhost:8015/  # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼å¿œç­”ç¢ºèª
```

**âš ï¸ è­¦å‘Šï¼šå€‹åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆdeploy-frontend-ec2.shç­‰ï¼‰ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**
ç†ç”±ï¼šç‰‡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠã ã‘ã‚’å†èµ·å‹•ã—ã¦ã—ã¾ã„ã€ã‚‚ã†ç‰‡æ–¹ãŒåœæ­¢ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### ãƒ‡ãƒ—ãƒ­ã‚¤ã®åŸºæœ¬çš„ãªæµã‚Œ

1.  **ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰**: ãƒ­ãƒ¼ã‚«ãƒ«ã§ `docker build` ã‚’å®Ÿè¡Œã—ã€æœ¬ç•ªç”¨ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚
2.  **ECRã¸ã®ãƒ—ãƒƒã‚·ãƒ¥**: ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ECRã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
3.  **ã‚µãƒ¼ãƒãƒ¼ã§ã®å®Ÿè¡Œ**: EC2ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã€ECRã‹ã‚‰æœ€æ–°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«ã—ã€`docker-compose` ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚

#### æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆè©³ç´°ï¼‰

##### 1ï¸âƒ£ ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã¨ECRã¸ã®ãƒ—ãƒƒã‚·ãƒ¥
```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤
./deploy-frontend.sh

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼APIã®ãƒ‡ãƒ—ãƒ­ã‚¤
./deploy-scheduler.sh
```

##### 2ï¸âƒ£ EC2ã‚µãƒ¼ãƒãƒ¼ã«SSHæ¥ç¶š
```bash
# EC2ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š
ssh -i ~/watchme-key.pem ubuntu@3.24.16.82
```

##### 3ï¸âƒ£ EC2ã‚µãƒ¼ãƒãƒ¼ã§ã®ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼ˆæ‰‹å‹•å®Ÿè¡Œã®å ´åˆï¼‰
```bash
# ECRã«ãƒ­ã‚°ã‚¤ãƒ³
aws ecr get-login-password --region ap-southeast-2 | docker login --username AWS --password-stdin 754724220380.dkr.ecr.ap-southeast-2.amazonaws.com

# æœ€æ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«
docker pull 754724220380.dkr.ecr.ap-southeast-2.amazonaws.com/watchme-api-manager:latest
docker pull 754724220380.dkr.ecr.ap-southeast-2.amazonaws.com/watchme-api-manager-scheduler:latest

# æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ãƒ»å‰Šé™¤
docker stop watchme-api-manager-prod watchme-scheduler-prod || true
docker rm watchme-api-manager-prod watchme-scheduler-prod || true

# âš ï¸ é‡è¦ï¼šå¿…ãšdocker-compose.all.ymlã‚’ä½¿ç”¨ï¼ˆä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ï¼‰
cd /home/ubuntu/watchme-api-manager
docker-compose -f docker-compose.all.yml up -d

# èµ·å‹•ç¢ºèªï¼ˆä¸¡æ–¹è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
docker ps | grep -E "api-manager|scheduler"
```

#### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ©Ÿèƒ½

**deploy-frontend-ec2.sh** ã®ä¸»ãªæ©Ÿèƒ½ï¼š
- ECRã‹ã‚‰æœ€æ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è‡ªå‹•ãƒ—ãƒ«
- æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã®å®‰å…¨ãªåœæ­¢ãƒ»å‰Šé™¤
- docker-compose.prod.ymlã‚’ä½¿ç”¨ã—ãŸèµ·å‹•
- watchme-networkã¸ã®è‡ªå‹•æ¥ç¶š
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª

**deploy-scheduler-ec2.sh** ã®ä¸»ãªæ©Ÿèƒ½ï¼š
- ECRã‹ã‚‰æœ€æ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è‡ªå‹•ãƒ—ãƒ«
- å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ­ã‚°æ¨©é™ã®è¨­å®š
- ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«(.env)ã®ç¢ºèª
- watchme-networkã¸ã®è‡ªå‹•æ¥ç¶š
- config.jsonç”Ÿæˆã®æ¡ˆå†…ã¨ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ã®æä¾›
- cronè¨­å®šã®æ‰‹å‹•æ›´æ–°æ‰‹é †ã®æç¤º

#### âš ï¸ **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®é‡è¦ãªæ³¨æ„ç‚¹**

##### 1. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š** 
**å•é¡Œ**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤ã„APIã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã¨ `Invalid API key` ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚
```bash
# âŒ ã‚¨ãƒ©ãƒ¼ä¾‹: 2025-08-08 15:00:03,045 - ERROR - whisper: æœªå‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼: {'message': 'Invalid API key'}

# âœ… è§£æ±ºæ–¹æ³•: ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨åŒã˜æœ€æ–°ã®APIã‚­ãƒ¼ã‚’ä½¿ç”¨
grep SUPABASE_KEY /home/ubuntu/watchme-vault-api-docker/.env
# ã“ã®å€¤ã‚’ /home/ubuntu/watchme-api-manager/.env ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹
```

##### 2. **ğŸš¨ ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã®è¨­å®šï¼ˆæœ€é‡è¦ï¼‰**
**å•é¡Œ**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒä»–ã®APIã‚’å‘¼ã³å‡ºã›ãªã„å ´åˆã€å¿…ãšã“ã®å•é¡Œã§ã™ã€‚
```bash
# âŒ ã‚¨ãƒ©ãƒ¼ä¾‹: Failed to resolve 'vibe-transcriber-v2' 
# âŒ ã‚¨ãƒ©ãƒ¼ä¾‹: Failed to resolve 'watchme-behavior-yamnet'

# âœ… è§£æ±ºæ–¹æ³•: å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’watchme-networkã«æ¥ç¶š
# å¿…é ˆã®æ¥ç¶šå…ˆã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§:
docker network connect watchme-network vibe-transcriber-v2      # Azure Speech (æ—§Whisperã®ä»£æ›¿)
docker network connect watchme-network api_gen_prompt_mood_chart # å¿ƒç†ã‚°ãƒ©ãƒ•ç”¨  
docker network connect watchme-network api-gpt-v1               # å¿ƒç†ã‚°ãƒ©ãƒ•ç”¨
docker network connect watchme-network sed-api                    # è¡Œå‹•ã‚°ãƒ©ãƒ•ç”¨
docker network connect watchme-network opensmile-api            # æ„Ÿæƒ…ã‚°ãƒ©ãƒ•ç”¨
```

##### 3. **æ­£ã—ã„ã‚³ãƒ³ãƒ†ãƒŠåã®ç¢ºèªæ–¹æ³•**
**å•é¡Œ**: `watchme-behavior-yamnet` ã®ã‚ˆã†ãªåå‰ã§æ¥ç¶šã—ã‚ˆã†ã¨ã—ã¦ã‚‚ã‚³ãƒ³ãƒ†ãƒŠãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚
```bash
# âœ… å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒŠåã‚’ç¢ºèªã™ã‚‹æ–¹æ³•:
docker ps --format "{{.Names}}" | grep -E "(api|watchme|vibe|mood|behavior|emotion)"

# å‡ºåŠ›ä¾‹:
# sed-api                 <- ã“ã‚ŒãŒè¡Œå‹•ã‚°ãƒ©ãƒ•APIï¼ˆãƒãƒ¼ãƒˆ8004ï¼‰
# opensmile-api            <- ã“ã‚ŒãŒæ„Ÿæƒ…ã‚°ãƒ©ãƒ•APIï¼ˆãƒãƒ¼ãƒˆ8011ï¼‰
# vibe-transcriber-v2      <- ã“ã‚ŒãŒAzure Speech APIï¼ˆãƒãƒ¼ãƒˆ8013ï¼‰ â€»Whisperã¯å‰Šé™¤æ¸ˆã¿
```

##### 4. **å‹•ä½œç¢ºèªæ–¹æ³•**
```bash
# 1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãƒ†ã‚¹ãƒˆ
docker exec watchme-scheduler-prod ping -c 1 vibe-transcriber-v2  # Azure Speech
docker exec watchme-scheduler-prod ping -c 1 sed-api  
docker exec watchme-scheduler-prod ping -c 1 opensmile-api

# 2. æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
# whisperã¯2025/09/02å‰Šé™¤æ¸ˆã¿ - Azure Speech (azure-transcriber)ã‚’ä½¿ç”¨
docker exec watchme-scheduler-prod python /app/run-api-process-docker.py azure-transcriber
docker exec watchme-scheduler-prod python /app/run-api-process-docker.py behavior-features

# 3. WebUIç¢ºèª
curl https://api.hey-watch.me/manager/
curl https://api.hey-watch.me/scheduler/status/whisper
```

##### 5. **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**
ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã€å¿…ãšä»¥ä¸‹ã‚’é †ç•ªã«ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```bash
# âœ… ãƒã‚§ãƒƒã‚¯1: ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
docker ps | grep -E "watchme-scheduler|watchme-api-manager"

# âœ… ãƒã‚§ãƒƒã‚¯2: ç’°å¢ƒå¤‰æ•°ã¯æ­£ã—ã„ã‹ï¼Ÿ
docker exec watchme-scheduler-prod env | grep SUPABASE_KEY

# âœ… ãƒã‚§ãƒƒã‚¯3: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
docker network inspect watchme-network | grep -A 3 "watchme-scheduler-prod"

# âœ… ãƒã‚§ãƒƒã‚¯4: å¯¾è±¡APIã‚³ãƒ³ãƒ†ãƒŠã¯å‹•ä½œã—ã¦ã„ã‚‹ã‹ï¼Ÿ
docker ps | grep -E "api-transcriber|sed-api|opensmile-api"

# âœ… ãƒã‚§ãƒƒã‚¯5: pingã¯é€šã‚‹ã‹ï¼Ÿ
docker exec watchme-scheduler-prod ping -c 1 vibe-transcriber-v2  # Azure Speech
```

#### ğŸ¤– **è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
æ¯å›æ‰‹å‹•ã§è¨­å®šã™ã‚‹ã®ã‚’é¿ã‘ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’EC2ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
#!/bin/bash
# å…¨ã‚³ãƒ³ãƒ†ãƒŠã‚’watchme-networkã«æ¥ç¶šã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ãƒ•ã‚¡ã‚¤ãƒ«å: /home/ubuntu/connect-all-containers.sh

echo "=== å…¨ã‚³ãƒ³ãƒ†ãƒŠã‚’watchme-networkã«æ¥ç¶šä¸­ ==="

# å¿…é ˆã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§
CONTAINERS=(
  "watchme-scheduler-prod"
  "watchme-api-manager-prod"
  "api-transcriber"
  "api_gen_prompt_mood_chart"
  "api-gpt-v1"
  "sed-api"
  "opensmile-api"
  "watchme-vault-api"
  "watchme-web-prod"
  "watchme-admin"
  "api-sed-aggregator"
)

for container in "${CONTAINERS[@]}"; do
  echo "æ¥ç¶šä¸­: $container"
  docker network connect watchme-network "$container" 2>/dev/null && echo "âœ… $container" || echo "âš ï¸ $container (æ—¢ã«æ¥ç¶šæ¸ˆã¿ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼)"
done

echo ""
echo "=== æ¥ç¶šãƒ†ã‚¹ãƒˆ ==="
echo "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ä¸»è¦APIã¸ã®pingãƒ†ã‚¹ãƒˆ:"
docker exec watchme-scheduler-prod ping -c 1 vibe-transcriber-v2  # Azure Speech >/dev/null 2>&1 && echo "âœ… api-transcriber" || echo "âŒ api-transcriber"
docker exec watchme-scheduler-prod ping -c 1 sed-api >/dev/null 2>&1 && echo "âœ… sed-api" || echo "âŒ sed-api"
docker exec watchme-scheduler-prod ping -c 1 opensmile-api >/dev/null 2>&1 && echo "âœ… opensmile-api" || echo "âŒ opensmile-api"

echo ""
echo "=== å®Œäº† ==="
```

**å®Ÿè¡Œæ–¹æ³•**:
```bash
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¦å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x /home/ubuntu/connect-all-containers.sh
/home/ubuntu/connect-all-containers.sh
```

### ã‚µãƒ¼ãƒãƒ¼è¨­å®š (Nginx / systemd) ã€é‡è¦ã€‘

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ¬ç•ªç’°å¢ƒã§æ­£ã—ãå‹•ä½œã•ã›ã‚‹ã«ã¯ã€EC2ã‚µãƒ¼ãƒãƒ¼å´ã§ **Nginx** ã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã¨ã€**systemd** ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†è¨­å®šãŒå¿…è¦ã§ã™ã€‚

**âš ï¸ systemdè¨­å®šã®é‡è¦ãªæ³¨æ„äº‹é …ï¼š**
- systemdã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ`watchme-api-manager.service`ï¼‰ã¯å¿…ãš`docker-compose.all.yml`ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™
- ã“ã‚Œã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã«API Managerã¨Schedulerã®ä¸¡æ–¹ãŒè‡ªå‹•èµ·å‹•ã•ã‚Œã¾ã™
- **çµ¶å¯¾ã«`docker-compose.prod.yml`ã«å¤‰æ›´ã—ãªã„ã§ãã ã•ã„**ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒèµ·å‹•ã—ãªããªã‚Šã¾ã™ï¼‰

ã“ã‚Œã‚‰ã®ã‚µãƒ¼ãƒãƒ¼è¨­å®šã¯ã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ç®¡ç†ã—ã¦ã„ã¾ã›ã‚“ã€‚**ã‚µãƒ¼ãƒãƒ¼è¨­å®šã«é–¢ã™ã‚‹å…¨ã¦ã®æƒ…å ±ã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä»¥ä¸‹ã®å°‚ç”¨ãƒªãƒã‚¸ãƒˆãƒªã§ä¸€å…ƒç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚**

**ã‚µãƒ¼ãƒãƒ¼è¨­å®šãƒªãƒã‚¸ãƒˆãƒª:**
[**watchme-server-configs**](https://github.com/matsumotokaya/watchme-server-configs)

ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ã€æ–°ã—ã„APIã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã€å¿…ãšä¸Šè¨˜ãƒªãƒã‚¸ãƒˆãƒªã® `README.md` ã‚’ç†Ÿèª­ã—ã€ã‚µãƒ¼ãƒãƒ¼å…¨ä½“ã®è¨­è¨ˆæ€æƒ³ã¨é‹ç”¨ãƒ«ãƒ¼ãƒ«ã‚’ç†è§£ã—ãŸä¸Šã§ã€é©åˆ‡ãªè¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å†…å®¹ |
|------|-----------|------|
| 2025-09-09 | v1.5.4 | Azure Transcriberå‡¦ç†æ”¹å–„ï¼ˆãƒãƒƒãƒã‚µã‚¤ã‚º10ä»¶åˆ¶é™ã€å‡¦ç†çŠ¶æ…‹ç´°åˆ†åŒ–ã€ãƒ­ã‚°å¼·åŒ–ï¼‰ |
| 2025-09-07 | v1.5.3 | timeblock-analysisã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¿½åŠ ã€dashboardãƒ†ãƒ¼ãƒ–ãƒ«ã®ChatGPTåˆ†æè‡ªå‹•åŒ– |
| 2025-09-03 | v1.5.2 | Whisper APIå‰Šé™¤ã«ä¼´ã†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã€Azure Speechã¸ã®å®Œå…¨ç§»è¡Œå®Œäº† |
| 2025-09-01 | v1.5.1 | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½æ”¹å–„ï¼ˆdevice_idå–å¾—ã®ç°¡ç´ åŒ–ã€analysis_resultã‚«ãƒ©ãƒ èª¬æ˜è¿½åŠ ï¼‰ |
| 2025-09-01 | v1.5.0 | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½è¿½åŠ ã€ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯å˜ä½ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Ÿè£… |
| 2025-08-26 | v1.4.0 | Azure Speech Service APIçµ±åˆæ”¹å–„ |
| 2025-08-25 | v1.3.0 | ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†æ©Ÿèƒ½å®Ÿè£… |
| 2025-08-22 | v1.2.3 | ç’°å¢ƒå¤‰æ•°ã®çµ±ä¸€ã€å…¨ãƒ‡ãƒã‚¤ã‚¹å‡¦ç†ã®ä¿®æ­£ |
| 2025-08-21 | v1.2.0 | å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œå®Ÿè£…ã€UIå¤§å¹…æ”¹å–„ |
| 2025-08-10 | v1.1.0 | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼å®Œå…¨å®Ÿè£…ã€UUIDæ¨™æº–åŒ– |

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é‹ç”¨ä¸­ã«ç™ºç”Ÿã—ãŸå•é¡Œã‚„ã€ãã®è§£æ±ºç­–ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- **éå»ã®éšœå®³äº‹ä¾‹:**
  - [**2025-08-08: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚¨ãƒ©ãƒ¼**](./docs/incidents/2025-08-08-scheduler-network-fix.md)
    - `host.docker.internal` ã®åå‰è§£æ±ºã«å¤±æ•—ã—ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒAPIã‚’å‘¼ã³å‡ºã›ãªã‹ã£ãŸå•é¡Œã®èª¿æŸ»ã¨è§£æ±ºã®è¨˜éŒ²ã§ã™ã€‚
  - **2025-08-11: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼500ã‚¨ãƒ©ãƒ¼ã®è§£æ±º**
    - UIã‹ã‚‰è¨­å®šå¤‰æ›´æ™‚ã®500ã‚¨ãƒ©ãƒ¼ã‚’ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ã«ã‚ˆã‚Šè§£æ±ºã—ã¾ã—ãŸã€‚è©³ç´°ã¯ä¸Šè¨˜ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ä»•çµ„ã¿ã€ã‚’å‚ç…§ã€‚
  - **2025-08-30: Azure Transcriberã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼æ¨©é™ã‚¨ãƒ©ãƒ¼**
    - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚¨ãƒ©ãƒ¼ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã—ãªã„å•é¡Œã‚’è§£æ±ºã€‚è©³ç´°ãªè¨ºæ–­æ‰‹é †ã‚’ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã—ãªã„å•é¡Œã®å®Œå…¨è¨ºæ–­ã‚¬ã‚¤ãƒ‰ã€ã«è¿½åŠ ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾ç­–

#### 0. ğŸš¨ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒèµ·å‹•ã—ãªã„ï¼ˆæœ€é »å‡ºå•é¡Œï¼‰
- **ç—‡çŠ¶**: API Manager UIã¯å‹•ä½œã™ã‚‹ãŒã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ã‹ãªã„
- **åŸå› **: 
  - `docker-compose.prod.yml`ã‚’ä½¿ã£ã¦ã—ã¾ã£ãŸï¼ˆAPI Managerã®ã¿èµ·å‹•ï¼‰
  - `docker-compose.all.yml`ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šãŒé–“é•ã£ã¦ã„ã‚‹
- **è¨ºæ–­æ–¹æ³•**:
  ```bash
  # ä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
  docker ps | grep -E "api-manager|scheduler"
  # watchme-scheduler-prodãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯å•é¡Œã‚ã‚Š
  ```
- **è§£æ±ºç­–**:
  ```bash
  # 1. docker-compose.all.ymlã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã‚’ç¢ºèª
  tail -5 /home/ubuntu/watchme-api-manager/docker-compose.all.yml
  # external: trueã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆdriver: bridgeã¯NGï¼‰
  
  # 2. ä¸¡æ–¹ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
  cd /home/ubuntu/watchme-api-manager
  docker-compose -f docker-compose.all.yml down
  docker-compose -f docker-compose.all.yml up -d
  
  # 3. ç¢ºèª
  docker ps | grep -E "api-manager|scheduler"
  ```

#### 1. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ··åŒã«ã‚ˆã‚‹404ã‚¨ãƒ©ãƒ¼
- **ç—‡çŠ¶**: APIãŒ404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€ã¾ãŸã¯ã€ŒCannot GET /api/scheduler/api/scheduler/...ã€ã®ã‚ˆã†ãªäºŒé‡ãƒ‘ã‚¹ã‚¨ãƒ©ãƒ¼
- **åŸå› **: 3ç¨®é¡ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆç®¡ç†ç”¨ã€å®Ÿè¡Œç”¨ã€å…¬é–‹ç”¨ï¼‰ã‚’æ··åŒã—ã¦ã„ã‚‹
- **è§£æ±ºç­–**: 
  - [ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®3å±¤æ§‹é€ ](#-ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®3å±¤æ§‹é€ ã‚’ç†è§£ã™ã‚‹é‡è¦) ã‚’ç†è§£ã™ã‚‹
  - FastAPIã¯ `/api/scheduler/` ã§ãƒªã‚¹ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆNginxãŒ `/scheduler/` â†’ `/api/scheduler/` ã«ãƒ—ãƒ­ã‚­ã‚·ã™ã‚‹ãŸã‚ï¼‰
  - å„APIã®å®Ÿè¡Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã‚³ãƒ³ãƒ†ãƒŠåã‚’ä½¿ç”¨ï¼ˆä¾‹: `http://api-transcriber:8001/fetch-and-transcribe`ï¼‰

#### 2. ğŸš¨ ã‚³ãƒ³ãƒ†ãƒŠå†ä½œæˆå¾Œã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ‡æ–­å•é¡Œã€é‡è¦ãƒ»é »ç™ºã€‘
- **ç—‡çŠ¶**: 
  - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ä»–ã®APIã‚’å‘¼ã³å‡ºã›ãªã„
  - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã«ã€Œã‚³ãƒ³ãƒ†ãƒŠå 'http://api-transcriber:8001/...' ãŒè§£æ±ºã§ãã¾ã›ã‚“ã€ã¨è¡¨ç¤º
  - ä»Šã¾ã§å‹•ã„ã¦ã„ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒæ€¥ã«å‹•ä½œã—ãªããªã‚‹
- **åŸå› **: 
  - **APIã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å†ä½œæˆã™ã‚‹ã¨ã€watchme-networkã¸ã®æ¥ç¶šãŒè‡ªå‹•çš„ã«åˆ‡æ–­ã•ã‚Œã‚‹**
  - Dockerã‚³ãƒ³ãƒ†ãƒŠã®å†ä½œæˆæ™‚ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã¯è‡ªå‹•å¾©å…ƒã•ã‚Œãªã„ä»•æ§˜
- **è¨ºæ–­æ–¹æ³•**:
  ```bash
  # è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œï¼ˆã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼‰
  ./diagnose-scheduler.sh
  
  # ã¾ãŸã¯æ‰‹å‹•ã§ç¢ºèª
  docker network inspect watchme-network | grep "api-transcriber"
  ```
- **è§£æ±ºç­–**: 
  ```bash
  # åˆ‡æ–­ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã‚’å†æ¥ç¶šï¼ˆä¾‹ï¼šWhisper APIã®å ´åˆï¼‰
  docker network connect watchme-network api-transcriber
  
  # å…¨APIã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ‹¬ã§å†æ¥ç¶šã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  for container in api-transcriber api-gpt-v1 api_gen_prompt_mood_chart \
                   sed-api api-sed-aggregator \
                   opensmile-api opensmile-aggregator; do
    docker network connect watchme-network $container 2>/dev/null && \
      echo "âœ… $container æ¥ç¶šå®Œäº†" || echo "âš ï¸ $container æ—¢ã«æ¥ç¶šæ¸ˆã¿"
  done
  ```
- **äºˆé˜²ç­–**:
  - ã‚³ãƒ³ãƒ†ãƒŠå†ä½œæˆå¾Œã¯å¿…ãš `docker network connect` ã‚’å®Ÿè¡Œ
  - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«è‡ªå‹•æ¥ç¶šå‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨

#### 3. ğŸš¨ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã—ãªã„å•é¡Œã®å®Œå…¨è¨ºæ–­ã‚¬ã‚¤ãƒ‰ã€2025-08-30è¿½åŠ ã€‘

ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã—ãªã„å ´åˆã€ä»¥ä¸‹ã®æ‰‹é †ã§**å¿…ãš**é †ç•ªã«è¨ºæ–­ã—ã¦ãã ã•ã„ã€‚

##### ç—‡çŠ¶ã®ä¾‹
- UIã§ã€Œæœ€çµ‚å‡¦ç†ã€ãŒæ›´æ–°ã•ã‚Œãªã„
- ç‰¹å®šã®APIã ã‘ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã•ã‚Œãªã„
- cronã¯å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãŒAPIãŒå‡¦ç†ã•ã‚Œãªã„

##### ã‚¹ãƒ†ãƒƒãƒ—1: cronã¨å…¨ãåŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•å®Ÿè¡Œï¼ˆæœ€é‡è¦ï¼‰
```bash
# SSHã§EC2ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š
ssh -i ~/watchme-key.pem ubuntu@3.24.16.82

# cronãŒå®Ÿè¡Œã™ã‚‹ã®ã¨å…¨ãåŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•ã§å®Ÿè¡Œ
# ã“ã‚ŒãŒæœ€ã‚‚ç¢ºå®Ÿãªæ¤œè¨¼æ–¹æ³•ã§ã™
python3 /home/ubuntu/scheduler/run_if_enabled.py [APIå] >> /var/log/scheduler/cron.log 2>&1

# ä¾‹ï¼šAzure Transcriberã®å ´åˆ
python3 /home/ubuntu/scheduler/run_if_enabled.py azure-transcriber >> /var/log/scheduler/cron.log 2>&1
```

##### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
```bash
# cron.logã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
tail -50 /var/log/scheduler/cron.log | grep -A 5 -B 5 [APIå]

# ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ï¼šPermission denied
# PermissionError: [Errno 13] Permission denied: '/var/log/scheduler/scheduler-[APIå].log'
```

##### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’ç¢ºèªãƒ»ä¿®æ­£
```bash
# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’ç¢ºèª
ls -la /var/log/scheduler/scheduler-*.log

# æ­£å¸¸ãªãƒ•ã‚¡ã‚¤ãƒ«: -rw-rw-r-- (664) ubuntu:ubuntu
# å•é¡Œã®ãƒ•ã‚¡ã‚¤ãƒ«: -rw-r--r-- (644) ã¾ãŸã¯ root:root

# æ¨©é™ã‚’ä¿®æ­£
sudo chown ubuntu:ubuntu /var/log/scheduler/scheduler-[APIå].log
sudo chmod 664 /var/log/scheduler/scheduler-[APIå].log
```

##### ã‚¹ãƒ†ãƒƒãƒ—4: watchme-networkã¸ã®æ¥ç¶šã‚’ç¢ºèª
```bash
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
bash /home/ubuntu/watchme-server-configs/scripts/check-infrastructure.sh

# ç‰¹å®šã®ã‚³ãƒ³ãƒ†ãƒŠã®æ¥ç¶šã‚’ç¢ºèª
docker network inspect watchme-network | grep -A 5 [ã‚³ãƒ³ãƒ†ãƒŠå]

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰å¯¾è±¡APIã¸ã®ç–é€šç¢ºèª
docker exec watchme-scheduler-prod ping -c 1 [ã‚³ãƒ³ãƒ†ãƒŠå]
```

##### ã‚¹ãƒ†ãƒƒãƒ—5: config.jsonã®è¨­å®šã‚’ç¢ºèª
```bash
# APIãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
cat /home/ubuntu/scheduler/config.json | jq '.apis["[APIå]"]'

# enabledãŒtrueã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
```

##### ã‚¹ãƒ†ãƒƒãƒ—6: æ‰‹å‹•ã§APIå‡¦ç†ã‚’å®Ÿè¡Œ
```bash
# Dockerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ç›´æ¥å®Ÿè¡Œã—ã¦APIãŒå‹•ä½œã™ã‚‹ã‹ç¢ºèª
docker exec watchme-scheduler-prod python /app/run-api-process-docker.py [APIå] --date $(date +%Y-%m-%d)
```

##### å®Ÿéš›ã®äº‹ä¾‹ï¼šAzure Transcriberï¼ˆ2025-08-30ï¼‰

**å•é¡Œ**: Azure Transcriberã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã—ãªã„
- cronã¯æ¯æ™‚10åˆ†ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ï¼ˆsyslogã§ç¢ºèªï¼‰
- ã—ã‹ã—å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

**åŸå› **: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚¨ãƒ©ãƒ¼
- `/var/log/scheduler/scheduler-azure-transcriber.log` ãŒ644ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰
- ubuntuãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ›¸ãè¾¼ã‚ãªã„ãŸã‚ã€run_if_enabled.pyãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥

**è§£æ±ºæ–¹æ³•**:
```bash
# æ¨©é™ã‚’ä¿®æ­£
sudo chown ubuntu:ubuntu /var/log/scheduler/scheduler-azure-transcriber.log
sudo chmod 664 /var/log/scheduler/scheduler-azure-transcriber.log

# å‹•ä½œç¢ºèªï¼ˆcronã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼‰
python3 /home/ubuntu/scheduler/run_if_enabled.py azure-transcriber >> /var/log/scheduler/cron.log 2>&1
```

##### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆæ–°ã—ã„APIã‚’è¿½åŠ ã—ãŸå ´åˆï¼‰

- [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ä½œæˆã•ã‚Œã€æ¨©é™ãŒ664ã«ãªã£ã¦ã„ã‚‹ã‹
- [ ] config.jsonã«APIãŒç™»éŒ²ã•ã‚Œã€enabledãŒtrueã‹
- [ ] watchme-networkã«ã‚³ãƒ³ãƒ†ãƒŠãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] cronè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«APIãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºè¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹

##### ä¾¿åˆ©ãªè¨ºæ–­ã‚³ãƒãƒ³ãƒ‰é›†

```bash
# ğŸ” ç·åˆè¨ºæ–­ï¼ˆã“ã‚Œ1ã¤ã§åŸºæœ¬çš„ãªå•é¡Œã‚’ç™ºè¦‹ï¼‰
echo "=== ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ç·åˆè¨ºæ–­ ===" && \
echo "1. æœ‰åŠ¹ãªAPI:" && cat /home/ubuntu/scheduler/config.json | jq -r '.apis | to_entries[] | select(.value.enabled == true) | .key' && \
echo "2. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™:" && ls -la /var/log/scheduler/*.log | grep -v "rw-rw-r--" && \
echo "3. æœ€è¿‘ã®ã‚¨ãƒ©ãƒ¼:" && tail -100 /var/log/scheduler/cron.log | grep -i error | tail -5 && \
echo "4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šçŠ¶æ…‹:" && bash /home/ubuntu/watchme-server-configs/scripts/check-infrastructure.sh | grep -E "SUCCESS|ERROR"

# ğŸ“Š ç‰¹å®šAPIã®å®Œå…¨è¨ºæ–­
API_NAME="azure-transcriber"  # è¨ºæ–­ã—ãŸã„APIåã«å¤‰æ›´
echo "=== $API_NAME è¨ºæ–­ ===" && \
echo "è¨­å®š:" && cat /home/ubuntu/scheduler/config.json | jq ".apis[\"$API_NAME\"]" && \
echo "ãƒ­ã‚°æ¨©é™:" && ls -la /var/log/scheduler/scheduler-$API_NAME.log && \
echo "æœ€çµ‚å®Ÿè¡Œ:" && tail -3 /var/log/scheduler/scheduler-$API_NAME.log && \
echo "cronå®Ÿè¡Œ:" && grep $API_NAME /etc/cron.d/watchme-scheduler && \
echo "å³åº§ã«å®Ÿè¡Œãƒ†ã‚¹ãƒˆ:" && python3 /home/ubuntu/scheduler/run_if_enabled.py $API_NAME

# ğŸ”§ å…¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’ä¸€æ‹¬ä¿®æ­£
for log in /var/log/scheduler/scheduler-*.log; do
  sudo chown ubuntu:ubuntu "$log"
  sudo chmod 664 "$log"
done
echo "å…¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’ä¿®æ­£ã—ã¾ã—ãŸ"

# ğŸŒ å…¨APIã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ä¸€æ‹¬ç¢ºèªãƒ»ä¿®æ­£
for container in api-transcriber vibe-transcriber-v2 api-gpt-v1 api_gen_prompt_mood_chart \
                 sed-api api-sed-aggregator \
                 opensmile-api opensmile-aggregator; do
  if docker ps --format "{{.Names}}" | grep -q "^$container$"; then
    docker network connect watchme-network $container 2>/dev/null && \
      echo "âœ… $container ã‚’æ¥ç¶š" || echo "âš ï¸ $container ã¯æ—¢ã«æ¥ç¶šæ¸ˆã¿"
  else
    echo "âŒ $container ã‚³ãƒ³ãƒ†ãƒŠãŒå­˜åœ¨ã—ã¾ã›ã‚“"
  fi
done

# ğŸ“ˆ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèª
echo "=== éå»1æ™‚é–“ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼å®Ÿè¡Œå±¥æ­´ ===" && \
for api in whisper azure-transcriber behavior-features vibe-aggregator behavior-aggregator emotion-features emotion-aggregator vibe-scorer; do
  count=$(grep -c "^$(date -u '+%Y-%m-%d %H').*$api.*å®Ÿè¡ŒæˆåŠŸ" /var/log/scheduler/cron.log 2>/dev/null || echo 0)
  echo "$api: $count å›æˆåŠŸ"
done
```

##### ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´ã¨å¯¾ç­–

1. **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒrootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ä½œæˆã•ã‚Œã‚‹å•é¡Œ**
   - åŸå› : åˆå›å®Ÿè¡Œæ™‚ã«sudoã‚’ä½¿ç”¨ã—ãŸã‚Šã€æ‰‹å‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
   - å¯¾ç­–: å¿…ãšubuntuãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œã€æ¨©é™ã¯664ã«çµ±ä¸€

2. **ã€Œå‹•ã„ã¦ã„ã‚‹ã¯ãšã€ã®æ€ã„è¾¼ã¿**
   - åŸå› : UIã®è¡¨ç¤ºã ã‘è¦‹ã¦åˆ¤æ–­
   - å¯¾ç­–: å¿…ãšcronã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•å®Ÿè¡Œã—ã¦æ¤œè¨¼

3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®è¦‹è½ã¨ã—**
   - åŸå› : ã‚³ãƒ³ãƒ†ãƒŠå†ä½œæˆæ™‚ã«watchme-networkã‹ã‚‰åˆ‡æ–­
   - å¯¾ç­–: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã¯å¿…ãšcheck-infrastructure.shã‚’å®Ÿè¡Œ

4. **config.jsonã®ä¸æ•´åˆ**
   - åŸå› : UIã‹ã‚‰è¨­å®šå¤‰æ›´ã—ãŸãŒåæ˜ ã•ã‚Œã¦ã„ãªã„
   - å¯¾ç­–: cat /home/ubuntu/scheduler/config.json ã§ç›´æ¥ç¢ºèª

#### 4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šæ¼ã‚Œ
- **ç—‡çŠ¶**: APIæ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚„Supabaseèªè¨¼ã‚¨ãƒ©ãƒ¼
- **åŸå› **: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ã‹ã€å¿…è¦ãªå¤‰æ•°ãŒä¸è¶³
- **è§£æ±ºç­–**: 
  - EC2ã‚µãƒ¼ãƒãƒ¼ã§ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
  - ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã® `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚è€ƒã«å¿…è¦ãªå€¤ã‚’è¨­å®š

#### 4. Nginxãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ç¢ºèª
- **ç—‡çŠ¶**: ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
- **ç¢ºèªæ–¹æ³•**: 
  ```bash
  # Nginxè¨­å®šã®ç¢ºèª
  sudo cat /etc/nginx/sites-available/api.hey-watch.me | grep -A 5 "location"
  ```

#### 5. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¨­å®šã®å•é¡Œ
- **ç—‡çŠ¶**: UIã‹ã‚‰è¨­å®šã‚’å¤‰æ›´ã—ã¦ã‚‚500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
- **åŸå› **: Dockerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ›ã‚¹ãƒˆã®cronãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„
- **è§£æ±ºç­–**: 2025-08-11ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ”¹å–„ã§è§£æ±ºæ¸ˆã¿ã€‚cronè¨­å®šã¯æ‰‹å‹•ç®¡ç†ã«å¤‰æ›´ã€‚

#### 6. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã•ã‚Œãªã„
- **ç—‡çŠ¶**: APIãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œãªã„
- **ç¢ºèªæ–¹æ³•**:
  ```bash
  # cronè¨­å®šã®ç¢ºèª
  cat /etc/cron.d/watchme-scheduler
  
  # config.jsonã®ç¢ºèª
  cat /home/ubuntu/scheduler/config.json
  
  # å®Ÿè¡Œãƒ­ã‚°ã®ç¢ºèª
  tail -f /var/log/scheduler/scheduler-[APIå].log
  ```
- **è§£æ±ºç­–**: 
  - cronè¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèª
  - run_if_enabled.pyãŒå®Ÿè¡Œå¯èƒ½ã‹ç¢ºèª
  - config.jsonã§APIãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

### ğŸ” ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®3å±¤æ§‹é€ ã‚’ç†è§£ã™ã‚‹ï¼ˆé‡è¦ï¼‰

WatchMeã‚·ã‚¹ãƒ†ãƒ ã«ã¯**3ç¨®é¡ã®ç•°ãªã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ãŒå­˜åœ¨ã—ã€ãã‚Œãã‚Œç•°ãªã‚‹å½¹å‰²ã‚’æŒã£ã¦ã„ã¾ã™ã€‚æ··åŒã—ãªã„ã‚ˆã†æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

#### 1ï¸âƒ£ **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼APIç®¡ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
- **ç”¨é€”**: API Managerã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®è¨­å®šï¼ˆON/OFFã€é–“éš”ç­‰ï¼‰ã‚’ç®¡ç†
- **ä¾‹**: `https://api.hey-watch.me/scheduler/status/whisper`
- **å†…éƒ¨ãƒ‘ã‚¹**: FastAPIã¯ `/api/scheduler/status/{api_name}` ã§ãƒªã‚¹ãƒ³
- **Nginxãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: `/scheduler/` â†’ `http://localhost:8015/api/scheduler/`
- **å®šç¾©å ´æ‰€**: `scheduler-api-server.py`

#### 2ï¸âƒ£ **å„APIã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè¡Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
- **ç”¨é€”**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒå„APIã‚’å®Ÿéš›ã«å®Ÿè¡Œã™ã‚‹éš›ã«å‘¼ã³å‡ºã™
- **ä¾‹**: whisperãªã‚‰ `/fetch-and-transcribe`
- **æ¥ç¶šå…ˆ**: `http://api-transcriber:8001/fetch-and-transcribe`ï¼ˆã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ï¼‰
- **å®šç¾©å ´æ‰€**: `scheduler/run-api-process-docker.py` ã® `API_CONFIGS` è¾æ›¸
- **æ³¨æ„**: ã‚³ãƒ³ãƒ†ãƒŠåã‚’ä½¿ç”¨ï¼ˆlocalhostã§ã¯ãªã„ï¼‰

#### 3ï¸âƒ£ **Nginxå…¬é–‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
- **ç”¨é€”**: å¤–éƒ¨ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç­‰ï¼‰ã‹ã‚‰APIã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã®ãƒ‘ã‚¹
- **ä¾‹**: `https://api.hey-watch.me/vibe-transcriber/`
- **Nginxãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: `/vibe-transcriber/` â†’ `http://api-transcriber:8001/`
- **å®šç¾©å ´æ‰€**: Nginxã‚µãƒ¼ãƒãƒ¼è¨­å®šï¼ˆwatchme-server-configs ãƒªãƒã‚¸ãƒˆãƒªï¼‰

#### ğŸ“Š ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç›¸é–¢å›³

```
[ãƒ–ãƒ©ã‚¦ã‚¶] 
    â†“ â‘  ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¨­å®šã‚’å¤‰æ›´
    https://api.hey-watch.me/scheduler/toggle/whisper
    â†“
[Nginx] â†’ [scheduler-api-server:8015/api/scheduler/toggle/whisper]
    â†“ config.jsonæ›´æ–°
    â†“
[cron] â†’ [run_if_enabled.py] 
    â†“ â‘¡ å®šæœŸå®Ÿè¡Œæ™‚ã«APIã‚’å‘¼ã³å‡ºã—
    â†“
[run-api-process-docker.py]
    â†“ http://api-transcriber:8001/fetch-and-transcribe
    â†“
[api-transcriber ã‚³ãƒ³ãƒ†ãƒŠ] â† å®Ÿéš›ã®å‡¦ç†
```

### ä»Šå¾Œã®å®Ÿè£…ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã«å‘ã‘ãŸæ¨å¥¨äº‹é …

1. **ğŸš¨ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­å®šã®ç¢ºèªï¼ˆæœ€é‡è¦ï¼‰**
   - æ–°ã—ã„APIã‚’è¿½åŠ ã™ã‚‹éš›ã¯ã€å¿…ãšä¸Šè¨˜ã®ã€Œã‚³ãƒ³ãƒ†ãƒŠåã¨APIå¯¾å¿œè¡¨ã€ã‚’æ›´æ–°
   - `run-api-process-docker.py`ã¨æ‰‹å‹•å®Ÿè¡Œç”¨ã®APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä¸€è‡´ã•ã›ã‚‹
   - **4ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¿…ãšåŒæœŸã•ã›ã‚‹:**
     - `/scheduler/run-api-process-docker.py` (Dockerç’°å¢ƒç”¨) - â‘¡ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
     - `/run-api-process.py` (ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒç”¨) - â‘¡ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
     - `/src/services/*ApiClient.js` (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨) - â‘ ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
     - Nginxè¨­å®š (watchme-server-configs) - â‘¢ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

2. **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ´»ç”¨**
   - `deploy-frontend.sh` ã¨ `deploy-scheduler.sh` ã‚’ä½¿ç”¨ã—ã¦ECRã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã‚’è‡ªå‹•åŒ–
   - EC2ã‚µãƒ¼ãƒãƒ¼å´ã®æ‰‹é †ã‚‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨

3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã®æ¨™æº–åŒ–**ï¼ˆ2025å¹´8æœˆ28æ—¥æ›´æ–°ï¼‰
   - æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã¯å¿…ãš `watchme-network` ã«æ¥ç¶š
   - `docker-compose.yml` ã« `networks` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜è¨˜ï¼š
     ```yaml
     networks:
       watchme-network:
         external: true  # å¿…é ˆï¼driver: bridgeã¯ä½¿ç”¨ã—ãªã„
     ```
   - **ã‚³ãƒ³ãƒ†ãƒŠåã®å‘½åè¦å‰‡:** ãƒã‚¤ãƒ•ãƒ³åŒºåˆ‡ã‚Šã§çµ±ä¸€ï¼ˆä¾‹: `api-transcriber`ã€`opensmile-api`ï¼‰

4. **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè£…**
   - å„APIã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…
   - docker-composeã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’è¨­å®š

5. **ãƒ­ã‚°ç›£è¦–**
   - `docker logs` ã‚³ãƒãƒ³ãƒ‰ã§å®šæœŸçš„ã«ãƒ­ã‚°ã‚’ç¢ºèª
   - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®ãƒ­ã‚°ã¯ `/var/log/scheduler/` ã«ä¿å­˜ã•ã‚Œã‚‹

6. **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆæ–¹æ³•**
   ```bash
   # Dockerç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆï¼ˆEC2ã‚µãƒ¼ãƒãƒ¼ä¸Šã§å®Ÿè¡Œï¼‰
   docker exec watchme-scheduler-prod python /app/run-api-process-docker.py [APIå]
   
   # ä¾‹ï¼šemotion-aggregatorã®ãƒ†ã‚¹ãƒˆ
   docker exec watchme-scheduler-prod python /app/run-api-process-docker.py emotion-aggregator
   ```

### ğŸ†• ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã«æ–°ã—ã„APIã‚’è¿½åŠ ã™ã‚‹è©³ç´°æ‰‹é †ï¼ˆ2025å¹´9æœˆ7æ—¥è¿½åŠ ï¼‰

#### âš ï¸ ä»Šå›ã®å®Ÿè£…ã§åˆ¤æ˜ã—ãŸé‡è¦ãªæ³¨æ„ç‚¹

ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã«APIã‚’è¿½åŠ ã™ã‚‹éš›ã€è¦‹è½ã¨ã—ã‚„ã™ã„é‡è¦ãªæ‰‹é †ãŒã‚ã‚Šã¾ã™ï¼š

1. **ğŸ”´ Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ›´æ–°ã‚’å¿˜ã‚Œãšã«ï¼**
   ```bash
   # ãƒ›ã‚¹ãƒˆå´ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›´æ–°ã—ãŸå¾Œã€å¿…ãšã‚³ãƒ³ãƒ†ãƒŠå†…ã‚‚æ›´æ–°
   docker cp /home/ubuntu/scheduler/run-api-process-docker.py \
             watchme-scheduler-prod:/app/run-api-process-docker.py
   ```
   ã“ã‚Œã‚’å¿˜ã‚Œã‚‹ã¨ã€Œæœªå¯¾å¿œã®APIã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

2. **ğŸ”´ cronã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•ãŒå¿…è¦**
   ```bash
   # /etc/cron.d/watchme-scheduler ã‚’ç·¨é›†ã—ãŸå¾Œ
   sudo systemctl restart cron
   ```
   ã“ã‚Œã‚’å¿˜ã‚Œã‚‹ã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚

3. **ğŸ”´ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™è¨­å®š**
   ```bash
   sudo touch /var/log/scheduler/scheduler-[APIå].log
   sudo chown ubuntu:ubuntu /var/log/scheduler/scheduler-[APIå].log
   sudo chmod 664 /var/log/scheduler/scheduler-[APIå].log
   ```
   æ¨©é™ãŒä¸é©åˆ‡ã ã¨Permission deniedã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

#### å®Ÿè£…æ‰‹é †ã®è©³ç´°

1. **run-api-process-docker.pyã¸ã®APIè¨­å®šè¿½åŠ **
   - API_CONFIGSè¾æ›¸ã«æ–°ã—ã„APIã‚’è¿½åŠ 
   - å‡¦ç†ã‚¿ã‚¤ãƒ—ã‚’é¸æŠï¼š`file_based`ã€`device_based`ã€ã¾ãŸã¯ç‹¬è‡ªã‚¿ã‚¤ãƒ—
   - å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒ å‡¦ç†é–¢æ•°ã‚’å®Ÿè£…

2. **EC2ã‚µãƒ¼ãƒãƒ¼ã§ã®è¨­å®š**
   ```bash
   # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨æ›´æ–°
   cp /home/ubuntu/scheduler/run-api-process-docker.py \
      /home/ubuntu/scheduler/run-api-process-docker.py.backup.$(date +%Y%m%d_%H%M%S)
   
   # GitHubã‹ã‚‰æœ€æ–°ç‰ˆã‚’å–å¾—ï¼ˆã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰è»¢é€ï¼‰
   scp -i ~/watchme-key.pem /path/to/local/run-api-process-docker.py \
       ubuntu@3.24.16.82:/home/ubuntu/scheduler/
   
   # Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã‚‚æ›´æ–°ï¼ˆé‡è¦ï¼ï¼‰
   docker cp /home/ubuntu/scheduler/run-api-process-docker.py \
             watchme-scheduler-prod:/app/run-api-process-docker.py
   ```

3. **cronè¨­å®šã®è¿½åŠ **
   ```bash
   # /etc/cron.d/watchme-scheduler ã«è¿½åŠ 
   # å®Ÿè¡Œæ™‚åˆ»ã¯ä»–ã®APIã¨ã®ä¾å­˜é–¢ä¿‚ã‚’è€ƒæ…®
   # 10åˆ†: ãƒ‡ãƒ¼ã‚¿åé›† â†’ 20åˆ†: åˆæœŸå‡¦ç† â†’ 30åˆ†: é›†è¨ˆ â†’ 40åˆ†: åˆ†æ
   40 * * * * ubuntu python3 /home/ubuntu/scheduler/run_if_enabled.py [APIå] >> /var/log/scheduler/cron.log 2>&1
   
   # å¿…ãšcronã‚’å†èµ·å‹•
   sudo systemctl restart cron
   ```

4. **config.jsonã¸ã®è¨­å®šè¿½åŠ **
   ```bash
   cat /home/ubuntu/scheduler/config.json | \
   jq '.apis["[APIå]"] = {"enabled": false, "timeout": 120, "batchLimit": 50}' \
   > /tmp/config.json && mv /tmp/config.json /home/ubuntu/scheduler/config.json
   ```

5. **å‹•ä½œãƒ†ã‚¹ãƒˆ**
   ```bash
   # ã¾ãšDockerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ç›´æ¥ãƒ†ã‚¹ãƒˆ
   docker exec watchme-scheduler-prod python /app/run-api-process-docker.py [APIå]
   
   # æˆåŠŸã—ãŸã‚‰run_if_enabled.pyçµŒç”±ã§ãƒ†ã‚¹ãƒˆ
   python3 /home/ubuntu/scheduler/run_if_enabled.py [APIå]
   ```

6. **æœ¬ç•ªç¨¼åƒ**
   ```bash
   # config.jsonã§enabledã‚’trueã«è¨­å®š
   cat /home/ubuntu/scheduler/config.json | \
   jq '.apis["[APIå]"].enabled = true' > /tmp/config.json && \
   mv /tmp/config.json /home/ubuntu/scheduler/config.json
   ```